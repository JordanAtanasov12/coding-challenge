{"ast":null,"code":"import { InfuraProvider } from 'ethers/providers';\nimport { utils, Contract } from 'ethers';\nimport { Promise } from 'es6-promise';\nimport ColonyNetworkClient from '../clients/ColonyNetworkClient';\nimport LogsService from './LogsService';\nexport default class PayoudClaimedService {\n  constructor() {\n    this.colonyClient = void 0;\n    this.networkClient = void 0;\n    this.networkClient = new ColonyNetworkClient();\n  }\n\n  async prepareLogs() {\n    try {\n      this.colonyClient = await this.networkClient.getClient();\n      const logsService = new LogsService();\n      const parsedLogs = await logsService.getParsedLogs(this.colonyClient.filters.PayoutClaimed(null, null, null)); //=============================================\n\n      const provider = new InfuraProvider();\n      const abi = [// Read-Only Functions\n      \"function balanceOf(address owner) view returns (uint256)\", \"function decimals() view returns (uint8)\", \"function symbol() view returns (string)\", // Authenticated Functions\n      \"function transfer(address to, uint amount) returns (bool)\", // Events\n      \"event Transfer(address indexed from, address indexed to, uint amount)\"];\n      const address = \"0x0dd7b8f3d1fa88FAbAa8a04A0c7B52FC35D4312c\";\n      const erc20 = new Contract(address, abi, provider);\n      const tokenInfo = erc20.symbol();\n      const [singleLog] = parsedLogs; // Create a new BigNumber instance from the hex string amount in the parsed log\n\n      const humanReadableAmount = new utils.BigNumber(singleLog.values.amount);\n      console.log(humanReadableAmount.toString()); //const wei = new utils.BigNumber(10);\n      // The converted amount is the human readable amount divided by the wei value raised to the power of 18\n\n      const convertedAmount = humanReadableAmount.div(humanReadableAmount.pow(18)); // If you are confident that it's a low enough value, you can display it as an integer -- .toNumber()\n      // But to be on the safe side, you can also use it as a string\n\n      console.log(convertedAmount.toString()); //const someInfo = await erc20.balanceOf(\"0x0dd7b8f3d1fa88FAbAa8a04A0c7B52FC35D4312c\", provider);\n      //=============================================\n\n      async function getAssoitaedTypeId(singleLog, colonyClient) {\n        const humanReadableFundingPotId = new utils.BigNumber(singleLog.values.fundingPotId).toString();\n        const {\n          associatedTypeId\n        } = await colonyClient.getFundingPot(humanReadableFundingPotId);\n        return associatedTypeId;\n      }\n\n      const promises = await parsedLogs.map(async singleLog => {\n        return getAssoitaedTypeId(singleLog, this.colonyClient).then(this.colonyClient.getPayment).then(r => Object.assign({}, singleLog, {\n          userAddress: r.recipient\n        }));\n      });\n      const preparedLogs = await Promise.all(promises);\n      return preparedLogs;\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n}","map":{"version":3,"names":["InfuraProvider","utils","Contract","Promise","ColonyNetworkClient","LogsService","PayoudClaimedService","constructor","colonyClient","networkClient","prepareLogs","getClient","logsService","parsedLogs","getParsedLogs","filters","PayoutClaimed","provider","abi","address","erc20","tokenInfo","symbol","singleLog","humanReadableAmount","BigNumber","values","amount","console","log","toString","convertedAmount","div","pow","getAssoitaedTypeId","humanReadableFundingPotId","fundingPotId","associatedTypeId","getFundingPot","promises","map","then","getPayment","r","Object","assign","userAddress","recipient","preparedLogs","all","error"],"sources":["/Users/jatanasov/Documents/Projects/Colony/coding-challenge-events-list-bootstrap/src/services/PayoudClaimedService.ts"],"sourcesContent":["import React, { useState } from \"react\";\nimport { getColonyNetworkClient, Network, ColonyRole, getBlockTime } from '@colony/colony-js';\nimport { Wallet } from 'ethers';\nimport { InfuraProvider, Web3Provider } from 'ethers/providers';\nimport { getLogs } from '@colony/colony-js';\nimport { Filter, Log, Provider } from 'ethers/providers';\nimport { utils, Contract } from 'ethers';\nimport { Promise } from 'es6-promise';\nimport ColonyNetworkClient from '../clients/ColonyNetworkClient';\nimport LogsService from './LogsService';\nimport { PayoutClaimedItem } from \"../interfaces/PayoutClaimedItem\";\nimport { getBalancesForEthereumAddress } from 'ethereum-erc20-token-balances-multicall';\nimport { MAINNET_NETWORK_ADDRESS, MAINNET_BETACOLONY_ADDRESS } from '../helpers/constants';\n\n\n\nexport default class PayoudClaimedService {\n\n    private colonyClient: any;\n    private networkClient: any;\n\n    constructor() {\n        this.networkClient = new ColonyNetworkClient();\n    }\n\n    public async prepareLogs() {\n\n        try {\n\n            this.colonyClient = await this.networkClient.getClient();\n\n            const logsService = new LogsService();\n\n            const parsedLogs: PayoutClaimedItem[] = await logsService.getParsedLogs(this.colonyClient.filters.PayoutClaimed(null, null, null));\n\n            //=============================================\n\n            const provider = new InfuraProvider();\n\n            const abi = [\n                // Read-Only Functions\n                \"function balanceOf(address owner) view returns (uint256)\",\n                \"function decimals() view returns (uint8)\",\n                \"function symbol() view returns (string)\",\n\n                // Authenticated Functions\n                \"function transfer(address to, uint amount) returns (bool)\",\n\n                // Events\n                \"event Transfer(address indexed from, address indexed to, uint amount)\"\n            ];\n\n            const address = \"0x0dd7b8f3d1fa88FAbAa8a04A0c7B52FC35D4312c\";\n\n            const erc20 = new Contract(address, abi, provider);\n            const tokenInfo = erc20.symbol();\n\n            const [singleLog] = parsedLogs;\n\n            // Create a new BigNumber instance from the hex string amount in the parsed log\n            const humanReadableAmount = new utils.BigNumber(singleLog.values.amount);\n\n            console.log(humanReadableAmount.toString());\n\n            //const wei = new utils.BigNumber(10);\n\n            // The converted amount is the human readable amount divided by the wei value raised to the power of 18\n            const convertedAmount = humanReadableAmount.div(humanReadableAmount.pow(18));\n\n            // If you are confident that it's a low enough value, you can display it as an integer -- .toNumber()\n            // But to be on the safe side, you can also use it as a string\n            console.log(convertedAmount.toString());\n\n            //const someInfo = await erc20.balanceOf(\"0x0dd7b8f3d1fa88FAbAa8a04A0c7B52FC35D4312c\", provider);\n\n\n            //=============================================\n\n            async function getAssoitaedTypeId(singleLog: PayoutClaimedItem, colonyClient: any) {\n                const humanReadableFundingPotId = new utils.BigNumber(\n                    singleLog.values.fundingPotId\n                ).toString();\n\n                const {\n                    associatedTypeId,\n                } = await colonyClient.getFundingPot(humanReadableFundingPotId);\n\n                return associatedTypeId;\n            }\n\n\n            const promises = await parsedLogs.map(async (singleLog) => {\n                return getAssoitaedTypeId(singleLog, this.colonyClient)\n                    .then(this.colonyClient.getPayment)\n                    .then(r => Object.assign({}, singleLog, { userAddress: r.recipient }))\n            });\n\n            const preparedLogs = await Promise.all(promises);\n            return preparedLogs;\n        } catch (error) {\n            console.log(error)\n        }\n    }\n\n\n}\n"],"mappings":"AAGA,SAASA,cAAT,QAA6C,kBAA7C;AAGA,SAASC,KAAT,EAAgBC,QAAhB,QAAgC,QAAhC;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,OAAOC,mBAAP,MAAgC,gCAAhC;AACA,OAAOC,WAAP,MAAwB,eAAxB;AAOA,eAAe,MAAMC,oBAAN,CAA2B;EAKtCC,WAAW,GAAG;IAAA,KAHNC,YAGM;IAAA,KAFNC,aAEM;IACV,KAAKA,aAAL,GAAqB,IAAIL,mBAAJ,EAArB;EACH;;EAEuB,MAAXM,WAAW,GAAG;IAEvB,IAAI;MAEA,KAAKF,YAAL,GAAoB,MAAM,KAAKC,aAAL,CAAmBE,SAAnB,EAA1B;MAEA,MAAMC,WAAW,GAAG,IAAIP,WAAJ,EAApB;MAEA,MAAMQ,UAA+B,GAAG,MAAMD,WAAW,CAACE,aAAZ,CAA0B,KAAKN,YAAL,CAAkBO,OAAlB,CAA0BC,aAA1B,CAAwC,IAAxC,EAA8C,IAA9C,EAAoD,IAApD,CAA1B,CAA9C,CANA,CAQA;;MAEA,MAAMC,QAAQ,GAAG,IAAIjB,cAAJ,EAAjB;MAEA,MAAMkB,GAAG,GAAG,CACR;MACA,0DAFQ,EAGR,0CAHQ,EAIR,yCAJQ,EAMR;MACA,2DAPQ,EASR;MACA,uEAVQ,CAAZ;MAaA,MAAMC,OAAO,GAAG,4CAAhB;MAEA,MAAMC,KAAK,GAAG,IAAIlB,QAAJ,CAAaiB,OAAb,EAAsBD,GAAtB,EAA2BD,QAA3B,CAAd;MACA,MAAMI,SAAS,GAAGD,KAAK,CAACE,MAAN,EAAlB;MAEA,MAAM,CAACC,SAAD,IAAcV,UAApB,CA9BA,CAgCA;;MACA,MAAMW,mBAAmB,GAAG,IAAIvB,KAAK,CAACwB,SAAV,CAAoBF,SAAS,CAACG,MAAV,CAAiBC,MAArC,CAA5B;MAEAC,OAAO,CAACC,GAAR,CAAYL,mBAAmB,CAACM,QAApB,EAAZ,EAnCA,CAqCA;MAEA;;MACA,MAAMC,eAAe,GAAGP,mBAAmB,CAACQ,GAApB,CAAwBR,mBAAmB,CAACS,GAApB,CAAwB,EAAxB,CAAxB,CAAxB,CAxCA,CA0CA;MACA;;MACAL,OAAO,CAACC,GAAR,CAAYE,eAAe,CAACD,QAAhB,EAAZ,EA5CA,CA8CA;MAGA;;MAEA,eAAeI,kBAAf,CAAkCX,SAAlC,EAAgEf,YAAhE,EAAmF;QAC/E,MAAM2B,yBAAyB,GAAG,IAAIlC,KAAK,CAACwB,SAAV,CAC9BF,SAAS,CAACG,MAAV,CAAiBU,YADa,EAEhCN,QAFgC,EAAlC;QAIA,MAAM;UACFO;QADE,IAEF,MAAM7B,YAAY,CAAC8B,aAAb,CAA2BH,yBAA3B,CAFV;QAIA,OAAOE,gBAAP;MACH;;MAGD,MAAME,QAAQ,GAAG,MAAM1B,UAAU,CAAC2B,GAAX,CAAe,MAAOjB,SAAP,IAAqB;QACvD,OAAOW,kBAAkB,CAACX,SAAD,EAAY,KAAKf,YAAjB,CAAlB,CACFiC,IADE,CACG,KAAKjC,YAAL,CAAkBkC,UADrB,EAEFD,IAFE,CAEGE,CAAC,IAAIC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBtB,SAAlB,EAA6B;UAAEuB,WAAW,EAAEH,CAAC,CAACI;QAAjB,CAA7B,CAFR,CAAP;MAGH,CAJsB,CAAvB;MAMA,MAAMC,YAAY,GAAG,MAAM7C,OAAO,CAAC8C,GAAR,CAAYV,QAAZ,CAA3B;MACA,OAAOS,YAAP;IACH,CAxED,CAwEE,OAAOE,KAAP,EAAc;MACZtB,OAAO,CAACC,GAAR,CAAYqB,KAAZ;IACH;EACJ;;AAtFqC"},"metadata":{},"sourceType":"module"}