{"ast":null,"code":"import { getColonyNetworkClient, Network } from '@colony/colony-js';\nimport { Wallet } from 'ethers';\nimport ethers from 'ethers';\nimport ColonyNetworkClient from '../clients/ColonyNetworkClient';\nimport LogsService from './LogsService';\nimport { getBalancesForEthereumAddress } from 'ethereum-erc20-token-balances-multicall';\nimport { MAINNET_BETACOLONY_ADDRESS } from '../helpers/constants';\nexport default class PayoudClaimedService {\n  constructor() {\n    this.colonyClient = void 0;\n    this.networkClient = void 0;\n    this.networkClient = new ColonyNetworkClient();\n  }\n\n  async prepareLogs() {\n    try {\n      this.colonyClient = await this.networkClient.getClient();\n      const logsService = new LogsService();\n      const parsedLogs = await logsService.getParsedLogs(this.colonyClient.filters.PayoutClaimed(null, null, null));\n\n      async function getAssoitaedTypeId(singleLog, colonyClient) {\n        const humanReadableFundingPotId = new ethers.utils.BigNumber(singleLog.values.fundingPotId).toString();\n        const {\n          associatedTypeId\n        } = await colonyClient.getFundingPot(humanReadableFundingPotId);\n        return associatedTypeId;\n      }\n\n      const promises = await parsedLogs.map(async singleLog => {\n        return getAssoitaedTypeId(singleLog, this.colonyClient).then(this.colonyClient.getPayment).then(r => Object.assign({}, singleLog, {\n          userAddress: r.recipient\n        }));\n      }); //const associatedTypeId = await getAssoitaedTypeId(parsedLogs[0], this.colonyClient);\n      //const userdAddress = await this.colonyClient.getPayment(associatedTypeId);\n      //const provider = new InfuraProvider();\n\n      const provider = new ethers.providers.Web3Provider(web3.currentProvider); // Get a random wallet\n\n      const wallet = Wallet.createRandom(); // Connect wallet to the provider\n\n      const connectedWallet = wallet.connect(provider);\n      const networkClient = await getColonyNetworkClient(Network.Mainnet, connectedWallet, {\n        networkAddress: MAINNET_BETACOLONY_ADDRESS\n      });\n      const balances = await getBalancesForEthereumAddress({\n        // erc20 tokens you want to query!\n        contractAddresses: [parsedLogs[0].values.token // unlimited amount you can keep adding and adding\n        // you can also build up easily through the code as well\n        ],\n        // ethereum address of the user you want to get the balances for\n        ethereumAddress: MAINNET_BETACOLONY_ADDRESS,\n        // your ethers provider\n        providerOptions: provider\n      });\n      console.log(balances); //const preparedLogs = await Promise.all(promises);\n      //return preparedLogs;\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n}","map":{"version":3,"names":["getColonyNetworkClient","Network","Wallet","ethers","ColonyNetworkClient","LogsService","getBalancesForEthereumAddress","MAINNET_BETACOLONY_ADDRESS","PayoudClaimedService","constructor","colonyClient","networkClient","prepareLogs","getClient","logsService","parsedLogs","getParsedLogs","filters","PayoutClaimed","getAssoitaedTypeId","singleLog","humanReadableFundingPotId","utils","BigNumber","values","fundingPotId","toString","associatedTypeId","getFundingPot","promises","map","then","getPayment","r","Object","assign","userAddress","recipient","provider","providers","Web3Provider","web3","currentProvider","wallet","createRandom","connectedWallet","connect","Mainnet","networkAddress","balances","contractAddresses","token","ethereumAddress","providerOptions","console","log","error"],"sources":["/Users/jatanasov/Documents/Projects/Colony/coding-challenge-events-list-bootstrap/src/services/PayoudClaimedService.ts"],"sourcesContent":["import React, { useState } from \"react\";\nimport { getColonyNetworkClient, Network, ColonyRole, getBlockTime } from '@colony/colony-js';\nimport { Wallet } from 'ethers';\nimport { InfuraProvider } from 'ethers/providers';\nimport { getLogs } from '@colony/colony-js';\nimport { Filter, Log, Provider } from 'ethers/providers';\nimport ethers from 'ethers';\nimport { Promise } from 'es6-promise';\nimport ColonyNetworkClient from '../clients/ColonyNetworkClient';\nimport LogsService from './LogsService';\nimport { PayoutClaimedItem } from \"../interfaces/PayoutClaimedItem\";\nimport { getBalancesForEthereumAddress } from 'ethereum-erc20-token-balances-multicall';\nimport { MAINNET_NETWORK_ADDRESS, MAINNET_BETACOLONY_ADDRESS } from '../helpers/constants';\nimport { constants } from \"perf_hooks\";\n\nexport default class PayoudClaimedService {\n\n    private colonyClient: any;\n    private networkClient: any;\n\n    constructor() {\n        this.networkClient = new ColonyNetworkClient();\n    }\n\n    public async prepareLogs() {\n\n        try {\n\n            this.colonyClient = await this.networkClient.getClient();\n\n            const logsService = new LogsService();\n\n            const parsedLogs: PayoutClaimedItem[] = await logsService.getParsedLogs(this.colonyClient.filters.PayoutClaimed(null, null, null));\n\n\n\n            async function getAssoitaedTypeId(singleLog: PayoutClaimedItem, colonyClient: any) {\n                const humanReadableFundingPotId = new ethers.utils.BigNumber(\n                    singleLog.values.fundingPotId\n                ).toString();\n\n                const {\n                    associatedTypeId,\n                } = await colonyClient.getFundingPot(humanReadableFundingPotId);\n\n                return associatedTypeId;\n            }\n\n\n            const promises = await parsedLogs.map(async (singleLog) => {\n                return getAssoitaedTypeId(singleLog, this.colonyClient)\n                    .then(this.colonyClient.getPayment)\n                    .then(r => Object.assign({}, singleLog, { userAddress: r.recipient }))\n            });\n\n            //const associatedTypeId = await getAssoitaedTypeId(parsedLogs[0], this.colonyClient);\n            //const userdAddress = await this.colonyClient.getPayment(associatedTypeId);\n\n            //const provider = new InfuraProvider();\n            const provider = new ethers.providers.Web3Provider(web3.currentProvider);\n\n            // Get a random wallet\n            const wallet = Wallet.createRandom();\n            // Connect wallet to the provider\n            const connectedWallet = wallet.connect(provider);\n\n            const networkClient = await getColonyNetworkClient(\n                Network.Mainnet,\n                connectedWallet,\n                {\n                    networkAddress: MAINNET_BETACOLONY_ADDRESS\n                },\n            );\n\n            \n            const balances = await getBalancesForEthereumAddress({\n                // erc20 tokens you want to query!\n                contractAddresses: [\n                    parsedLogs[0].values.token,\n                  // unlimited amount you can keep adding and adding\n                  // you can also build up easily through the code as well\n                ],\n                // ethereum address of the user you want to get the balances for\n                ethereumAddress: MAINNET_BETACOLONY_ADDRESS,\n                // your ethers provider\n                providerOptions: provider,\n              });\n\n              console.log(balances);\n\n            //const preparedLogs = await Promise.all(promises);\n            //return preparedLogs;\n        } catch (error) {\n            console.log(error)\n        }\n    }\n\n\n}\n"],"mappings":"AACA,SAASA,sBAAT,EAAiCC,OAAjC,QAA0E,mBAA1E;AACA,SAASC,MAAT,QAAuB,QAAvB;AAIA,OAAOC,MAAP,MAAmB,QAAnB;AAEA,OAAOC,mBAAP,MAAgC,gCAAhC;AACA,OAAOC,WAAP,MAAwB,eAAxB;AAEA,SAASC,6BAAT,QAA8C,yCAA9C;AACA,SAAkCC,0BAAlC,QAAoE,sBAApE;AAGA,eAAe,MAAMC,oBAAN,CAA2B;EAKtCC,WAAW,GAAG;IAAA,KAHNC,YAGM;IAAA,KAFNC,aAEM;IACV,KAAKA,aAAL,GAAqB,IAAIP,mBAAJ,EAArB;EACH;;EAEuB,MAAXQ,WAAW,GAAG;IAEvB,IAAI;MAEA,KAAKF,YAAL,GAAoB,MAAM,KAAKC,aAAL,CAAmBE,SAAnB,EAA1B;MAEA,MAAMC,WAAW,GAAG,IAAIT,WAAJ,EAApB;MAEA,MAAMU,UAA+B,GAAG,MAAMD,WAAW,CAACE,aAAZ,CAA0B,KAAKN,YAAL,CAAkBO,OAAlB,CAA0BC,aAA1B,CAAwC,IAAxC,EAA8C,IAA9C,EAAoD,IAApD,CAA1B,CAA9C;;MAIA,eAAeC,kBAAf,CAAkCC,SAAlC,EAAgEV,YAAhE,EAAmF;QAC/E,MAAMW,yBAAyB,GAAG,IAAIlB,MAAM,CAACmB,KAAP,CAAaC,SAAjB,CAC9BH,SAAS,CAACI,MAAV,CAAiBC,YADa,EAEhCC,QAFgC,EAAlC;QAIA,MAAM;UACFC;QADE,IAEF,MAAMjB,YAAY,CAACkB,aAAb,CAA2BP,yBAA3B,CAFV;QAIA,OAAOM,gBAAP;MACH;;MAGD,MAAME,QAAQ,GAAG,MAAMd,UAAU,CAACe,GAAX,CAAe,MAAOV,SAAP,IAAqB;QACvD,OAAOD,kBAAkB,CAACC,SAAD,EAAY,KAAKV,YAAjB,CAAlB,CACFqB,IADE,CACG,KAAKrB,YAAL,CAAkBsB,UADrB,EAEFD,IAFE,CAEGE,CAAC,IAAIC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBf,SAAlB,EAA6B;UAAEgB,WAAW,EAAEH,CAAC,CAACI;QAAjB,CAA7B,CAFR,CAAP;MAGH,CAJsB,CAAvB,CAvBA,CA6BA;MACA;MAEA;;MACA,MAAMC,QAAQ,GAAG,IAAInC,MAAM,CAACoC,SAAP,CAAiBC,YAArB,CAAkCC,IAAI,CAACC,eAAvC,CAAjB,CAjCA,CAmCA;;MACA,MAAMC,MAAM,GAAGzC,MAAM,CAAC0C,YAAP,EAAf,CApCA,CAqCA;;MACA,MAAMC,eAAe,GAAGF,MAAM,CAACG,OAAP,CAAeR,QAAf,CAAxB;MAEA,MAAM3B,aAAa,GAAG,MAAMX,sBAAsB,CAC9CC,OAAO,CAAC8C,OADsC,EAE9CF,eAF8C,EAG9C;QACIG,cAAc,EAAEzC;MADpB,CAH8C,CAAlD;MASA,MAAM0C,QAAQ,GAAG,MAAM3C,6BAA6B,CAAC;QACjD;QACA4C,iBAAiB,EAAE,CACfnC,UAAU,CAAC,CAAD,CAAV,CAAcS,MAAd,CAAqB2B,KADN,CAEjB;QACA;QAHiB,CAF8B;QAOjD;QACAC,eAAe,EAAE7C,0BARgC;QASjD;QACA8C,eAAe,EAAEf;MAVgC,CAAD,CAApD;MAaEgB,OAAO,CAACC,GAAR,CAAYN,QAAZ,EA9DF,CAgEA;MACA;IACH,CAlED,CAkEE,OAAOO,KAAP,EAAc;MACZF,OAAO,CAACC,GAAR,CAAYC,KAAZ;IACH;EACJ;;AAhFqC"},"metadata":{},"sourceType":"module"}