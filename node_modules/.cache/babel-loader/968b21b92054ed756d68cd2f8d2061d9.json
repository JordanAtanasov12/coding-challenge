{"ast":null,"code":"'use strict';\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar address_1 = require(\"../utils/address\");\n\nvar bignumber_1 = require(\"../utils/bignumber\");\n\nvar bytes_1 = require(\"../utils/bytes\");\n\nvar constants_1 = require(\"../constants\");\n\nvar hash_1 = require(\"../utils/hash\");\n\nvar networks_1 = require(\"../utils/networks\");\n\nvar properties_1 = require(\"../utils/properties\");\n\nvar rlp_1 = require(\"../utils/rlp\");\n\nvar transaction_1 = require(\"../utils/transaction\");\n\nvar utf8_1 = require(\"../utils/utf8\");\n\nvar web_1 = require(\"../utils/web\");\n\nvar errors = __importStar(require(\"../errors\")); ///////////////////////////////\n// Imported Abstracts\n\n\nvar abstract_provider_1 = require(\"./abstract-provider\"); //////////////////////////////\n// Request and Response Checking\n// @TODO: not any?\n\n\nfunction check(format, object) {\n  var result = {};\n\n  for (var key in format) {\n    try {\n      var value = format[key](object[key]);\n\n      if (value !== undefined) {\n        result[key] = value;\n      }\n    } catch (error) {\n      error.checkKey = key;\n      error.checkValue = object[key];\n      throw error;\n    }\n  }\n\n  return result;\n}\n\nfunction allowNull(check, nullValue) {\n  return function (value) {\n    if (value == null) {\n      return nullValue;\n    }\n\n    return check(value);\n  };\n}\n\nfunction allowFalsish(check, replaceValue) {\n  return function (value) {\n    if (!value) {\n      return replaceValue;\n    }\n\n    return check(value);\n  };\n}\n\nfunction arrayOf(check) {\n  return function (array) {\n    if (!Array.isArray(array)) {\n      throw new Error('not an array');\n    }\n\n    var result = [];\n    array.forEach(function (value) {\n      result.push(check(value));\n    });\n    return result;\n  };\n}\n\nfunction checkHash(hash, requirePrefix) {\n  if (typeof hash === 'string') {\n    // geth-etc does add a \"0x\" prefix on receipt.root\n    if (!requirePrefix && hash.substring(0, 2) !== '0x') {\n      hash = '0x' + hash;\n    }\n\n    if (bytes_1.hexDataLength(hash) === 32) {\n      return hash.toLowerCase();\n    }\n  }\n\n  errors.throwError('invalid hash', errors.INVALID_ARGUMENT, {\n    arg: 'hash',\n    value: hash\n  });\n  return null;\n}\n\nfunction checkNumber(number) {\n  return bignumber_1.bigNumberify(number).toNumber();\n} // Returns the difficulty as a number, or if too large (i.e. PoA network) null\n\n\nfunction checkDifficulty(value) {\n  var v = bignumber_1.bigNumberify(value);\n\n  try {\n    return v.toNumber();\n  } catch (error) {}\n\n  return null;\n}\n\nfunction checkBoolean(value) {\n  if (typeof value === 'boolean') {\n    return value;\n  }\n\n  if (typeof value === 'string') {\n    if (value === 'true') {\n      return true;\n    }\n\n    if (value === 'false') {\n      return false;\n    }\n  }\n\n  throw new Error('invaid boolean - ' + value);\n}\n\nfunction checkUint256(uint256) {\n  if (!bytes_1.isHexString(uint256)) {\n    throw new Error('invalid uint256');\n  }\n\n  while (uint256.length < 66) {\n    uint256 = '0x0' + uint256.substring(2);\n  }\n\n  return uint256;\n}\n/*\nfunction checkString(string) {\n    if (typeof(string) !== 'string') { throw new Error('invalid string'); }\n    return string;\n}\n*/\n\n\nfunction checkBlockTag(blockTag) {\n  if (blockTag == null) {\n    return 'latest';\n  }\n\n  if (blockTag === 'earliest') {\n    return '0x0';\n  }\n\n  if (blockTag === 'latest' || blockTag === 'pending') {\n    return blockTag;\n  }\n\n  if (typeof blockTag === 'number') {\n    return bytes_1.hexStripZeros(bytes_1.hexlify(blockTag));\n  }\n\n  if (bytes_1.isHexString(blockTag)) {\n    return bytes_1.hexStripZeros(blockTag);\n  }\n\n  throw new Error('invalid blockTag');\n}\n\nvar formatTransaction = {\n  hash: checkHash,\n  blockHash: allowNull(checkHash, null),\n  blockNumber: allowNull(checkNumber, null),\n  transactionIndex: allowNull(checkNumber, null),\n  confirmations: allowNull(checkNumber, null),\n  from: address_1.getAddress,\n  gasPrice: bignumber_1.bigNumberify,\n  gasLimit: bignumber_1.bigNumberify,\n  to: allowNull(address_1.getAddress, null),\n  value: bignumber_1.bigNumberify,\n  nonce: checkNumber,\n  data: bytes_1.hexlify,\n  r: allowNull(checkUint256),\n  s: allowNull(checkUint256),\n  v: allowNull(checkNumber),\n  creates: allowNull(address_1.getAddress, null),\n  raw: allowNull(bytes_1.hexlify)\n};\n\nfunction checkTransactionResponse(transaction) {\n  // Rename gas to gasLimit\n  if (transaction.gas != null && transaction.gasLimit == null) {\n    transaction.gasLimit = transaction.gas;\n  } // Some clients (TestRPC) do strange things like return 0x0 for the\n  // 0 address; correct this to be a real address\n\n\n  if (transaction.to && bignumber_1.bigNumberify(transaction.to).isZero()) {\n    transaction.to = '0x0000000000000000000000000000000000000000';\n  } // Rename input to data\n\n\n  if (transaction.input != null && transaction.data == null) {\n    transaction.data = transaction.input;\n  } // If to and creates are empty, populate the creates from the transaction\n\n\n  if (transaction.to == null && transaction.creates == null) {\n    transaction.creates = address_1.getContractAddress(transaction);\n  } // @TODO: use transaction.serialize? Have to add support for including v, r, and s...\n\n\n  if (!transaction.raw) {\n    // Very loose providers (e.g. TestRPC) don't provide a signature or raw\n    if (transaction.v && transaction.r && transaction.s) {\n      var raw = [bytes_1.stripZeros(bytes_1.hexlify(transaction.nonce)), bytes_1.stripZeros(bytes_1.hexlify(transaction.gasPrice)), bytes_1.stripZeros(bytes_1.hexlify(transaction.gasLimit)), transaction.to || \"0x\", bytes_1.stripZeros(bytes_1.hexlify(transaction.value || '0x')), bytes_1.hexlify(transaction.data || '0x'), bytes_1.stripZeros(bytes_1.hexlify(transaction.v || '0x')), bytes_1.stripZeros(bytes_1.hexlify(transaction.r)), bytes_1.stripZeros(bytes_1.hexlify(transaction.s))];\n      transaction.raw = rlp_1.encode(raw);\n    }\n  }\n\n  var result = check(formatTransaction, transaction);\n  var networkId = transaction.networkId; // geth-etc returns chainId\n\n  if (transaction.chainId != null && networkId == null && result.v == null) {\n    networkId = transaction.chainId;\n  }\n\n  if (bytes_1.isHexString(networkId)) {\n    networkId = bignumber_1.bigNumberify(networkId).toNumber();\n  }\n\n  if (typeof networkId !== 'number' && result.v != null) {\n    networkId = (result.v - 35) / 2;\n\n    if (networkId < 0) {\n      networkId = 0;\n    }\n\n    networkId = parseInt(networkId);\n  }\n\n  if (typeof networkId !== 'number') {\n    networkId = 0;\n  }\n\n  result.networkId = networkId;\n\n  if (result.chainId == null && networkId != null) {\n    result.chainId = networkId;\n  } // 0x0000... should actually be null\n\n\n  if (result.blockHash && result.blockHash.replace(/0/g, '') === 'x') {\n    result.blockHash = null;\n  }\n\n  return result;\n}\n\nvar formatBlock = {\n  hash: checkHash,\n  parentHash: checkHash,\n  number: checkNumber,\n  timestamp: checkNumber,\n  nonce: allowNull(bytes_1.hexlify),\n  difficulty: checkDifficulty,\n  gasLimit: bignumber_1.bigNumberify,\n  gasUsed: bignumber_1.bigNumberify,\n  miner: address_1.getAddress,\n  extraData: bytes_1.hexlify,\n  transactions: allowNull(arrayOf(checkHash))\n};\nvar formatBlockWithTransactions = properties_1.shallowCopy(formatBlock);\nformatBlockWithTransactions.transactions = allowNull(arrayOf(checkTransactionResponse));\n\nfunction checkBlock(block, includeTransactions) {\n  if (block.author != null && block.miner == null) {\n    block.miner = block.author;\n  }\n\n  return check(includeTransactions ? formatBlockWithTransactions : formatBlock, block);\n}\n\nvar formatTransactionRequest = {\n  from: allowNull(address_1.getAddress),\n  nonce: allowNull(checkNumber),\n  gasLimit: allowNull(bignumber_1.bigNumberify),\n  gasPrice: allowNull(bignumber_1.bigNumberify),\n  to: allowNull(address_1.getAddress),\n  value: allowNull(bignumber_1.bigNumberify),\n  data: allowNull(bytes_1.hexlify)\n};\n\nfunction checkTransactionRequest(transaction) {\n  return check(formatTransactionRequest, transaction);\n}\n\nvar formatTransactionReceiptLog = {\n  transactionLogIndex: allowNull(checkNumber),\n  transactionIndex: checkNumber,\n  blockNumber: checkNumber,\n  transactionHash: checkHash,\n  address: address_1.getAddress,\n  topics: arrayOf(checkHash),\n  data: bytes_1.hexlify,\n  logIndex: checkNumber,\n  blockHash: checkHash\n};\n\nfunction checkTransactionReceiptLog(log) {\n  return check(formatTransactionReceiptLog, log);\n}\n\nvar formatTransactionReceipt = {\n  to: allowNull(address_1.getAddress, null),\n  from: allowNull(address_1.getAddress, null),\n  contractAddress: allowNull(address_1.getAddress, null),\n  transactionIndex: checkNumber,\n  root: allowNull(checkHash),\n  gasUsed: bignumber_1.bigNumberify,\n  logsBloom: allowNull(bytes_1.hexlify),\n  blockHash: checkHash,\n  transactionHash: checkHash,\n  logs: arrayOf(checkTransactionReceiptLog),\n  blockNumber: checkNumber,\n  confirmations: allowNull(checkNumber, null),\n  cumulativeGasUsed: bignumber_1.bigNumberify,\n  status: allowNull(checkNumber)\n};\n\nfunction checkTransactionReceipt(transactionReceipt) {\n  //var status = transactionReceipt.status;\n  //var root = transactionReceipt.root;\n  var result = check(formatTransactionReceipt, transactionReceipt);\n  result.logs.forEach(function (entry, index) {\n    if (entry.transactionLogIndex == null) {\n      entry.transactionLogIndex = index;\n    }\n  });\n\n  if (transactionReceipt.status != null) {\n    result.byzantium = true;\n  }\n\n  return result;\n}\n\nfunction checkTopics(topics) {\n  if (Array.isArray(topics)) {\n    topics.forEach(function (topic) {\n      checkTopics(topic);\n    });\n  } else if (topics != null) {\n    checkHash(topics);\n  }\n\n  return topics;\n}\n\nvar formatFilter = {\n  fromBlock: allowNull(checkBlockTag, undefined),\n  toBlock: allowNull(checkBlockTag, undefined),\n  address: allowNull(address_1.getAddress, undefined),\n  topics: allowNull(checkTopics, undefined)\n};\nvar formatFilterByBlock = {\n  blockHash: allowNull(checkHash, undefined),\n  address: allowNull(address_1.getAddress, undefined),\n  topics: allowNull(checkTopics, undefined)\n};\n\nfunction checkFilter(filter) {\n  if (filter && filter.blockHash) {\n    return check(formatFilterByBlock, filter);\n  }\n\n  return check(formatFilter, filter);\n}\n\nvar formatLog = {\n  blockNumber: allowNull(checkNumber),\n  blockHash: allowNull(checkHash),\n  transactionIndex: checkNumber,\n  removed: allowNull(checkBoolean),\n  address: address_1.getAddress,\n  data: allowFalsish(bytes_1.hexlify, '0x'),\n  topics: arrayOf(checkHash),\n  transactionHash: checkHash,\n  logIndex: checkNumber\n};\n\nfunction checkLog(log) {\n  return check(formatLog, log);\n} //////////////////////////////\n// Event Serializeing\n\n\nfunction serializeTopics(topics) {\n  return topics.map(function (topic) {\n    if (typeof topic === 'string') {\n      return topic;\n    } else if (Array.isArray(topic)) {\n      topic.forEach(function (topic) {\n        if (topic !== null && bytes_1.hexDataLength(topic) !== 32) {\n          errors.throwError('invalid topic', errors.INVALID_ARGUMENT, {\n            argument: 'topic',\n            value: topic\n          });\n        }\n      });\n      return topic.join(',');\n    } else if (topic === null) {\n      return '';\n    }\n\n    return errors.throwError('invalid topic value', errors.INVALID_ARGUMENT, {\n      argument: 'topic',\n      value: topic\n    });\n  }).join('&');\n}\n\nfunction deserializeTopics(data) {\n  return data.split(/&/g).map(function (topic) {\n    var comps = topic.split(',');\n\n    if (comps.length === 1) {\n      if (comps[0] === '') {\n        return null;\n      }\n\n      return topic;\n    }\n\n    return comps.map(function (topic) {\n      if (topic === '') {\n        return null;\n      }\n\n      return topic;\n    });\n  });\n}\n\nfunction getEventTag(eventName) {\n  if (typeof eventName === 'string') {\n    if (bytes_1.hexDataLength(eventName) === 20) {\n      return 'address:' + address_1.getAddress(eventName);\n    }\n\n    eventName = eventName.toLowerCase();\n\n    if (bytes_1.hexDataLength(eventName) === 32) {\n      return 'tx:' + eventName;\n    }\n\n    if (eventName.indexOf(':') === -1) {\n      return eventName;\n    }\n  } else if (Array.isArray(eventName)) {\n    return 'filter::' + serializeTopics(eventName);\n  } else if (eventName && typeof eventName === 'object') {\n    return 'filter:' + (eventName.address || '') + ':' + serializeTopics(eventName.topics || []);\n  }\n\n  throw new Error('invalid event - ' + eventName);\n} //////////////////////////////\n// Helper Object\n\n\nfunction getTime() {\n  return new Date().getTime();\n}\n\nvar BaseProvider =\n/** @class */\nfunction (_super) {\n  __extends(BaseProvider, _super);\n\n  function BaseProvider(network) {\n    var _this = _super.call(this) || this;\n\n    errors.checkNew(_this, abstract_provider_1.Provider);\n\n    if (network instanceof Promise) {\n      properties_1.defineReadOnly(_this, 'ready', network.then(function (network) {\n        properties_1.defineReadOnly(_this, '_network', network);\n        return network;\n      })); // Squash any \"unhandled promise\" errors; the don't need to be handled\n\n      _this.ready.catch(function (error) {});\n    } else {\n      var knownNetwork = networks_1.getNetwork(network == null ? 'homestead' : network);\n\n      if (knownNetwork) {\n        properties_1.defineReadOnly(_this, '_network', knownNetwork);\n        properties_1.defineReadOnly(_this, 'ready', Promise.resolve(_this._network));\n      } else {\n        errors.throwError('invalid network', errors.INVALID_ARGUMENT, {\n          arg: 'network',\n          value: network\n        });\n      }\n    }\n\n    _this._lastBlockNumber = -2; // Balances being watched for changes\n\n    _this._balances = {}; // Events being listened to\n\n    _this._events = [];\n    _this._pollingInterval = 4000;\n    _this._emitted = {\n      block: -2\n    };\n    _this._fastQueryDate = 0;\n    return _this;\n  }\n\n  BaseProvider.prototype._doPoll = function () {\n    var _this = this;\n\n    this.getBlockNumber().then(function (blockNumber) {\n      if (!_this.polling) {\n        return;\n      }\n\n      _this._setFastBlockNumber(blockNumber); // If the block hasn't changed, meh.\n\n\n      if (blockNumber === _this._lastBlockNumber) {\n        return;\n      } // First polling cycle, trigger a \"block\" events\n\n\n      if (_this._emitted.block === -2) {\n        _this._emitted.block = blockNumber - 1;\n      } // Notify all listener for each block that has passed\n\n\n      for (var i = _this._emitted.block + 1; i <= blockNumber; i++) {\n        _this.emit('block', i);\n      } // The emitted block was updated, check for obsolete events\n\n\n      if (_this._emitted.block !== blockNumber) {\n        _this._emitted.block = blockNumber;\n        Object.keys(_this._emitted).forEach(function (key) {\n          // The block event does not expire\n          if (key === 'block') {\n            return;\n          } // The block we were at when we emitted this event\n\n\n          var eventBlockNumber = _this._emitted[key]; // We cannot garbage collect pending transactions or blocks here\n          // They should be garbage collected by the Provider when setting\n          // \"pending\" events\n\n          if (eventBlockNumber === 'pending') {\n            return;\n          } // Evict any transaction hashes or block hashes over 12 blocks\n          // old, since they should not return null anyways\n\n\n          if (blockNumber - eventBlockNumber > 12) {\n            delete _this._emitted[key];\n          }\n        });\n      } // First polling cycle\n\n\n      if (_this._lastBlockNumber === -2) {\n        _this._lastBlockNumber = blockNumber - 1;\n      } // Sweep balances and remove addresses we no longer have events for\n\n\n      var newBalances = {}; // Find all transaction hashes we are waiting on\n\n      var uniqueEventTags = {};\n\n      _this._events.forEach(function (event) {\n        uniqueEventTags[event.tag] = true;\n      });\n\n      Object.keys(uniqueEventTags).forEach(function (tag) {\n        var comps = tag.split(':');\n\n        switch (comps[0]) {\n          case 'tx':\n            {\n              var hash_2 = comps[1];\n\n              _this.getTransactionReceipt(hash_2).then(function (receipt) {\n                if (!receipt || receipt.blockNumber == null) {\n                  return null;\n                }\n\n                _this._emitted['t:' + hash_2] = receipt.blockNumber;\n\n                _this.emit(hash_2, receipt);\n\n                return null;\n              }).catch(function (error) {\n                _this.emit('error', error);\n              });\n\n              break;\n            }\n\n          case 'address':\n            {\n              var address_2 = comps[1];\n\n              if (_this._balances[address_2]) {\n                newBalances[address_2] = _this._balances[address_2];\n              }\n\n              _this.getBalance(address_2, 'latest').then(function (balance) {\n                var lastBalance = _this._balances[address_2];\n\n                if (lastBalance && balance.eq(lastBalance)) {\n                  return;\n                }\n\n                _this._balances[address_2] = balance;\n\n                _this.emit(address_2, balance);\n\n                return null;\n              }).catch(function (error) {\n                _this.emit('error', error);\n              });\n\n              break;\n            }\n\n          case 'filter':\n            {\n              var topics = deserializeTopics(comps[2]);\n              var filter_1 = {\n                address: comps[1],\n                fromBlock: _this._lastBlockNumber + 1,\n                toBlock: blockNumber,\n                topics: topics\n              };\n\n              if (!filter_1.address) {\n                delete filter_1.address;\n              }\n\n              _this.getLogs(filter_1).then(function (logs) {\n                if (logs.length === 0) {\n                  return;\n                }\n\n                logs.forEach(function (log) {\n                  _this._emitted['b:' + log.blockHash] = log.blockNumber;\n                  _this._emitted['t:' + log.transactionHash] = log.blockNumber;\n\n                  _this.emit(filter_1, log);\n                });\n                return null;\n              }).catch(function (error) {\n                _this.emit('error', error);\n              });\n\n              break;\n            }\n        }\n      });\n      _this._lastBlockNumber = blockNumber;\n      _this._balances = newBalances;\n      return null;\n    }).catch(function (error) {});\n    this.doPoll();\n  };\n\n  BaseProvider.prototype.resetEventsBlock = function (blockNumber) {\n    this._lastBlockNumber = blockNumber - 1;\n\n    if (this.polling) {\n      this._doPoll();\n    }\n  };\n\n  Object.defineProperty(BaseProvider.prototype, \"network\", {\n    get: function () {\n      return this._network;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  BaseProvider.prototype.getNetwork = function () {\n    return this.ready;\n  };\n\n  Object.defineProperty(BaseProvider.prototype, \"blockNumber\", {\n    get: function () {\n      return this._fastBlockNumber;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(BaseProvider.prototype, \"polling\", {\n    get: function () {\n      return this._poller != null;\n    },\n    set: function (value) {\n      var _this = this;\n\n      setTimeout(function () {\n        if (value && !_this._poller) {\n          _this._poller = setInterval(_this._doPoll.bind(_this), _this.pollingInterval);\n\n          _this._doPoll();\n        } else if (!value && _this._poller) {\n          clearInterval(_this._poller);\n          _this._poller = null;\n        }\n      }, 0);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(BaseProvider.prototype, \"pollingInterval\", {\n    get: function () {\n      return this._pollingInterval;\n    },\n    set: function (value) {\n      var _this = this;\n\n      if (typeof value !== 'number' || value <= 0 || parseInt(String(value)) != value) {\n        throw new Error('invalid polling interval');\n      }\n\n      this._pollingInterval = value;\n\n      if (this._poller) {\n        clearInterval(this._poller);\n        this._poller = setInterval(function () {\n          _this._doPoll();\n        }, this._pollingInterval);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  BaseProvider.prototype._getFastBlockNumber = function () {\n    var _this = this;\n\n    var now = getTime(); // Stale block number, request a newer value\n\n    if (now - this._fastQueryDate > 2 * this._pollingInterval) {\n      this._fastQueryDate = now;\n      this._fastBlockNumberPromise = this.getBlockNumber().then(function (blockNumber) {\n        if (_this._fastBlockNumber == null || blockNumber > _this._fastBlockNumber) {\n          _this._fastBlockNumber = blockNumber;\n        }\n\n        return _this._fastBlockNumber;\n      });\n    }\n\n    return this._fastBlockNumberPromise;\n  };\n\n  BaseProvider.prototype._setFastBlockNumber = function (blockNumber) {\n    // Older block, maybe a stale request\n    if (this._fastBlockNumber != null && blockNumber < this._fastBlockNumber) {\n      return;\n    } // Update the time we updated the blocknumber\n\n\n    this._fastQueryDate = getTime(); // Newer block number, use  it\n\n    if (this._fastBlockNumber == null || blockNumber > this._fastBlockNumber) {\n      this._fastBlockNumber = blockNumber;\n      this._fastBlockNumberPromise = Promise.resolve(blockNumber);\n    }\n  }; // @TODO: Add .poller which must be an event emitter with a 'start', 'stop' and 'block' event;\n  //        this will be used once we move to the WebSocket or other alternatives to polling\n\n\n  BaseProvider.prototype.waitForTransaction = function (transactionHash, confirmations) {\n    var _this = this;\n\n    if (confirmations == null) {\n      confirmations = 1;\n    }\n\n    return this.getTransactionReceipt(transactionHash).then(function (receipt) {\n      if (confirmations === 0 || receipt && receipt.confirmations >= confirmations) {\n        return receipt;\n      }\n\n      return new Promise(function (resolve) {\n        var handler = function (receipt) {\n          if (receipt.confirmations < confirmations) {\n            return;\n          }\n\n          _this.removeListener(transactionHash, handler);\n\n          resolve(receipt);\n        };\n\n        _this.on(transactionHash, handler);\n      });\n    });\n  };\n\n  BaseProvider.prototype.getBlockNumber = function () {\n    var _this = this;\n\n    return this.ready.then(function () {\n      return _this.perform('getBlockNumber', {}).then(function (result) {\n        var value = parseInt(result);\n\n        if (value != result) {\n          throw new Error('invalid response - getBlockNumber');\n        }\n\n        _this._setFastBlockNumber(value);\n\n        return value;\n      });\n    });\n  };\n\n  BaseProvider.prototype.getGasPrice = function () {\n    var _this = this;\n\n    return this.ready.then(function () {\n      return _this.perform('getGasPrice', {}).then(function (result) {\n        return bignumber_1.bigNumberify(result);\n      });\n    });\n  };\n\n  BaseProvider.prototype.getBalance = function (addressOrName, blockTag) {\n    var _this = this;\n\n    return this.ready.then(function () {\n      return properties_1.resolveProperties({\n        addressOrName: addressOrName,\n        blockTag: blockTag\n      }).then(function (_a) {\n        var addressOrName = _a.addressOrName,\n            blockTag = _a.blockTag;\n        return _this._getAddress(addressOrName).then(function (address) {\n          var params = {\n            address: address,\n            blockTag: checkBlockTag(blockTag)\n          };\n          return _this.perform('getBalance', params).then(function (result) {\n            return bignumber_1.bigNumberify(result);\n          });\n        });\n      });\n    });\n  };\n\n  BaseProvider.prototype.getTransactionCount = function (addressOrName, blockTag) {\n    var _this = this;\n\n    return this.ready.then(function () {\n      return properties_1.resolveProperties({\n        addressOrName: addressOrName,\n        blockTag: blockTag\n      }).then(function (_a) {\n        var addressOrName = _a.addressOrName,\n            blockTag = _a.blockTag;\n        return _this._getAddress(addressOrName).then(function (address) {\n          var params = {\n            address: address,\n            blockTag: checkBlockTag(blockTag)\n          };\n          return _this.perform('getTransactionCount', params).then(function (result) {\n            return bignumber_1.bigNumberify(result).toNumber();\n          });\n        });\n      });\n    });\n  };\n\n  BaseProvider.prototype.getCode = function (addressOrName, blockTag) {\n    var _this = this;\n\n    return this.ready.then(function () {\n      return properties_1.resolveProperties({\n        addressOrName: addressOrName,\n        blockTag: blockTag\n      }).then(function (_a) {\n        var addressOrName = _a.addressOrName,\n            blockTag = _a.blockTag;\n        return _this._getAddress(addressOrName).then(function (address) {\n          var params = {\n            address: address,\n            blockTag: checkBlockTag(blockTag)\n          };\n          return _this.perform('getCode', params).then(function (result) {\n            return bytes_1.hexlify(result);\n          });\n        });\n      });\n    });\n  };\n\n  BaseProvider.prototype.getStorageAt = function (addressOrName, position, blockTag) {\n    var _this = this;\n\n    return this.ready.then(function () {\n      return properties_1.resolveProperties({\n        addressOrName: addressOrName,\n        position: position,\n        blockTag: blockTag\n      }).then(function (_a) {\n        var addressOrName = _a.addressOrName,\n            position = _a.position,\n            blockTag = _a.blockTag;\n        return _this._getAddress(addressOrName).then(function (address) {\n          var params = {\n            address: address,\n            blockTag: checkBlockTag(blockTag),\n            position: bytes_1.hexStripZeros(bytes_1.hexlify(position))\n          };\n          return _this.perform('getStorageAt', params).then(function (result) {\n            return bytes_1.hexlify(result);\n          });\n        });\n      });\n    });\n  };\n\n  BaseProvider.prototype.sendTransaction = function (signedTransaction) {\n    var _this = this;\n\n    return this.ready.then(function () {\n      return properties_1.resolveProperties({\n        signedTransaction: signedTransaction\n      }).then(function (_a) {\n        var signedTransaction = _a.signedTransaction;\n        var params = {\n          signedTransaction: bytes_1.hexlify(signedTransaction)\n        };\n        return _this.perform('sendTransaction', params).then(function (hash) {\n          return _this._wrapTransaction(transaction_1.parse(signedTransaction), hash);\n        }, function (error) {\n          error.transaction = transaction_1.parse(signedTransaction);\n\n          if (error.transaction.hash) {\n            error.transactionHash = error.transaction.hash;\n          }\n\n          throw error;\n        });\n      });\n    });\n  }; // This should be called by any subclass wrapping a TransactionResponse\n\n\n  BaseProvider.prototype._wrapTransaction = function (tx, hash) {\n    var _this = this;\n\n    if (hash != null && bytes_1.hexDataLength(hash) !== 32) {\n      throw new Error('invalid response - sendTransaction');\n    }\n\n    var result = tx; // Check the hash we expect is the same as the hash the server reported\n\n    if (hash != null && tx.hash !== hash) {\n      errors.throwError('Transaction hash mismatch from Provider.sendTransaction.', errors.UNKNOWN_ERROR, {\n        expectedHash: tx.hash,\n        returnedHash: hash\n      });\n    } // @TODO: (confirmations? number, timeout? number)\n\n\n    result.wait = function (confirmations) {\n      // We know this transaction *must* exist (whether it gets mined is\n      // another story), so setting an emitted value forces us to\n      // wait even if the node returns null for the receipt\n      if (confirmations !== 0) {\n        _this._emitted['t:' + tx.hash] = 'pending';\n      }\n\n      return _this.waitForTransaction(tx.hash, confirmations).then(function (receipt) {\n        if (receipt == null && confirmations === 0) {\n          return null;\n        } // No longer pending, allow the polling loop to garbage collect this\n\n\n        _this._emitted['t:' + tx.hash] = receipt.blockNumber;\n\n        if (receipt.status === 0) {\n          errors.throwError('transaction failed', errors.CALL_EXCEPTION, {\n            transactionHash: tx.hash,\n            transaction: tx\n          });\n        }\n\n        return receipt;\n      });\n    };\n\n    return result;\n  };\n\n  BaseProvider.prototype.call = function (transaction, blockTag) {\n    var _this = this;\n\n    var tx = properties_1.shallowCopy(transaction);\n    return this.ready.then(function () {\n      return properties_1.resolveProperties({\n        blockTag: blockTag,\n        tx: tx\n      }).then(function (_a) {\n        var blockTag = _a.blockTag,\n            tx = _a.tx;\n        return _this._resolveNames(tx, ['to', 'from']).then(function (tx) {\n          var params = {\n            blockTag: checkBlockTag(blockTag),\n            transaction: checkTransactionRequest(tx)\n          };\n          return _this.perform('call', params).then(function (result) {\n            return bytes_1.hexlify(result);\n          });\n        });\n      });\n    });\n  };\n\n  BaseProvider.prototype.estimateGas = function (transaction) {\n    var _this = this;\n\n    var tx = {\n      to: transaction.to,\n      from: transaction.from,\n      data: transaction.data,\n      gasPrice: transaction.gasPrice,\n      value: transaction.value\n    };\n    return this.ready.then(function () {\n      return properties_1.resolveProperties(tx).then(function (tx) {\n        return _this._resolveNames(tx, ['to', 'from']).then(function (tx) {\n          var params = {\n            transaction: checkTransactionRequest(tx)\n          };\n          return _this.perform('estimateGas', params).then(function (result) {\n            return bignumber_1.bigNumberify(result);\n          });\n        });\n      });\n    });\n  };\n\n  BaseProvider.prototype.getBlock = function (blockHashOrBlockTag, includeTransactions) {\n    var _this = this;\n\n    return this.ready.then(function () {\n      return properties_1.resolveProperties({\n        blockHashOrBlockTag: blockHashOrBlockTag\n      }).then(function (_a) {\n        var blockHashOrBlockTag = _a.blockHashOrBlockTag;\n\n        try {\n          var blockHash_1 = bytes_1.hexlify(blockHashOrBlockTag);\n\n          if (bytes_1.hexDataLength(blockHash_1) === 32) {\n            return web_1.poll(function () {\n              return _this.perform('getBlock', {\n                blockHash: blockHash_1,\n                includeTransactions: !!includeTransactions\n              }).then(function (block) {\n                if (block == null) {\n                  if (_this._emitted['b:' + blockHash_1] == null) {\n                    return null;\n                  }\n\n                  return undefined;\n                }\n\n                return checkBlock(block, includeTransactions);\n              });\n            }, {\n              onceBlock: _this\n            });\n          }\n        } catch (error) {}\n\n        try {\n          var blockNumber_1 = -128;\n          var blockTag_1 = checkBlockTag(blockHashOrBlockTag);\n\n          if (bytes_1.isHexString(blockTag_1)) {\n            blockNumber_1 = parseInt(blockTag_1.substring(2), 16);\n          }\n\n          return web_1.poll(function () {\n            return _this.perform('getBlock', {\n              blockTag: blockTag_1,\n              includeTransactions: !!includeTransactions\n            }).then(function (block) {\n              if (block == null) {\n                if (blockNumber_1 <= _this._emitted.block) {\n                  return undefined;\n                }\n\n                return null;\n              }\n\n              return checkBlock(block, includeTransactions);\n            });\n          }, {\n            onceBlock: _this\n          });\n        } catch (error) {}\n\n        throw new Error('invalid block hash or block tag');\n      });\n    });\n  };\n\n  BaseProvider.prototype.getTransaction = function (transactionHash) {\n    var _this = this;\n\n    return this.ready.then(function () {\n      return properties_1.resolveProperties({\n        transactionHash: transactionHash\n      }).then(function (_a) {\n        var transactionHash = _a.transactionHash;\n        var params = {\n          transactionHash: checkHash(transactionHash, true)\n        };\n        return web_1.poll(function () {\n          return _this.perform('getTransaction', params).then(function (result) {\n            if (result == null) {\n              if (_this._emitted['t:' + transactionHash] == null) {\n                return null;\n              }\n\n              return undefined;\n            }\n\n            var tx = BaseProvider.checkTransactionResponse(result);\n\n            if (tx.blockNumber == null) {\n              tx.confirmations = 0;\n            } else if (tx.confirmations == null) {\n              return _this._getFastBlockNumber().then(function (blockNumber) {\n                // Add the confirmations using the fast block number (pessimistic)\n                var confirmations = blockNumber - tx.blockNumber + 1;\n\n                if (confirmations <= 0) {\n                  confirmations = 1;\n                }\n\n                tx.confirmations = confirmations;\n                return _this._wrapTransaction(tx);\n              });\n            }\n\n            return _this._wrapTransaction(tx);\n          });\n        }, {\n          onceBlock: _this\n        });\n      });\n    });\n  };\n\n  BaseProvider.prototype.getTransactionReceipt = function (transactionHash) {\n    var _this = this;\n\n    return this.ready.then(function () {\n      return properties_1.resolveProperties({\n        transactionHash: transactionHash\n      }).then(function (_a) {\n        var transactionHash = _a.transactionHash;\n        var params = {\n          transactionHash: checkHash(transactionHash, true)\n        };\n        return web_1.poll(function () {\n          return _this.perform('getTransactionReceipt', params).then(function (result) {\n            if (result == null) {\n              if (_this._emitted['t:' + transactionHash] == null) {\n                return null;\n              }\n\n              return undefined;\n            } // \"geth-etc\" returns receipts before they are ready\n\n\n            if (result.blockHash == null) {\n              return undefined;\n            }\n\n            var receipt = checkTransactionReceipt(result);\n\n            if (receipt.blockNumber == null) {\n              receipt.confirmations = 0;\n            } else if (receipt.confirmations == null) {\n              return _this._getFastBlockNumber().then(function (blockNumber) {\n                // Add the confirmations using the fast block number (pessimistic)\n                var confirmations = blockNumber - receipt.blockNumber + 1;\n\n                if (confirmations <= 0) {\n                  confirmations = 1;\n                }\n\n                receipt.confirmations = confirmations;\n                return receipt;\n              });\n            }\n\n            return receipt;\n          });\n        }, {\n          onceBlock: _this\n        });\n      });\n    });\n  };\n\n  BaseProvider.prototype.getLogs = function (filter) {\n    var _this = this;\n\n    return this.ready.then(function () {\n      return properties_1.resolveProperties(filter).then(function (filter) {\n        return _this._resolveNames(filter, ['address']).then(function (filter) {\n          var params = {\n            filter: checkFilter(filter)\n          };\n          return _this.perform('getLogs', params).then(function (result) {\n            return arrayOf(checkLog)(result);\n          });\n        });\n      });\n    });\n  };\n\n  BaseProvider.prototype.getEtherPrice = function () {\n    var _this = this;\n\n    return this.ready.then(function () {\n      return _this.perform('getEtherPrice', {}).then(function (result) {\n        // @TODO: Check valid float\n        return result;\n      });\n    });\n  };\n\n  BaseProvider.prototype._getAddress = function (addressOrName) {\n    return this.resolveName(addressOrName).then(function (address) {\n      if (address == null) {\n        errors.throwError(\"ENS name not configured\", errors.UNSUPPORTED_OPERATION, {\n          operation: \"resolveName(\" + JSON.stringify(addressOrName) + \")\"\n        });\n      }\n\n      return address;\n    });\n  }; // @TODO: Could probably use resolveProperties instead?\n\n\n  BaseProvider.prototype._resolveNames = function (object, keys) {\n    var promises = [];\n    var result = properties_1.shallowCopy(object);\n    keys.forEach(function (key) {\n      if (result[key] == null) {\n        return;\n      }\n\n      promises.push(this._getAddress(result[key]).then(function (address) {\n        result[key] = address;\n        return;\n      }));\n    }, this);\n    return Promise.all(promises).then(function () {\n      return result;\n    });\n  };\n\n  BaseProvider.prototype._getResolver = function (name) {\n    var _this = this; // Get the resolver from the blockchain\n\n\n    return this.getNetwork().then(function (network) {\n      // No ENS...\n      if (!network.ensAddress) {\n        errors.throwError('network does not support ENS', errors.UNSUPPORTED_OPERATION, {\n          operation: 'ENS',\n          network: network.name\n        });\n      } // keccak256('resolver(bytes32)')\n\n\n      var data = '0x0178b8bf' + hash_1.namehash(name).substring(2);\n      var transaction = {\n        to: network.ensAddress,\n        data: data\n      };\n      return _this.call(transaction).then(function (data) {\n        // extract the address from the data\n        if (bytes_1.hexDataLength(data) !== 32) {\n          return null;\n        }\n\n        var address = address_1.getAddress(bytes_1.hexDataSlice(data, 12));\n\n        if (address === constants_1.AddressZero) {\n          return null;\n        }\n\n        return address;\n      });\n    });\n  };\n\n  BaseProvider.prototype.resolveName = function (name) {\n    var _this = this; // If it is a promise, resolve it then recurse\n\n\n    if (name instanceof Promise) {\n      return name.then(function (addressOrName) {\n        return _this.resolveName(addressOrName);\n      });\n    } // If it is already an address, nothing to resolve\n\n\n    try {\n      return Promise.resolve(address_1.getAddress(name));\n    } catch (error) {\n      // See #694\n      if (bytes_1.isHexString(name)) {\n        throw error;\n      }\n    }\n\n    var self = this;\n    var nodeHash = hash_1.namehash(name); // Get the addr from the resovler\n\n    return this._getResolver(name).then(function (resolverAddress) {\n      if (resolverAddress == null) {\n        return null;\n      } // keccak256('addr(bytes32)')\n\n\n      var data = '0x3b3b57de' + nodeHash.substring(2);\n      var transaction = {\n        to: resolverAddress,\n        data: data\n      };\n      return self.call(transaction); // extract the address from the data\n    }).then(function (data) {\n      if (bytes_1.hexDataLength(data) !== 32) {\n        return null;\n      }\n\n      var address = address_1.getAddress(bytes_1.hexDataSlice(data, 12));\n\n      if (address === constants_1.AddressZero) {\n        return null;\n      }\n\n      return address;\n    });\n  };\n\n  BaseProvider.prototype.lookupAddress = function (address) {\n    var _this = this;\n\n    if (address instanceof Promise) {\n      return address.then(function (address) {\n        return _this.lookupAddress(address);\n      });\n    }\n\n    address = address_1.getAddress(address);\n    var name = address.substring(2) + '.addr.reverse';\n    var nodehash = hash_1.namehash(name);\n    var self = this;\n    return this._getResolver(name).then(function (resolverAddress) {\n      if (!resolverAddress) {\n        return null;\n      } // keccak('name(bytes32)')\n\n\n      var data = '0x691f3431' + nodehash.substring(2);\n      var transaction = {\n        to: resolverAddress,\n        data: data\n      };\n      return self.call(transaction);\n    }).then(function (data) {\n      if (data == null) {\n        return null;\n      } // Strip off the \"0x\"\n\n\n      data = data.substring(2); // Strip off the dynamic string pointer (0x20)\n\n      if (data.length < 64) {\n        return null;\n      }\n\n      data = data.substring(64);\n\n      if (data.length < 64) {\n        return null;\n      }\n\n      var length = bignumber_1.bigNumberify('0x' + data.substring(0, 64)).toNumber();\n      data = data.substring(64);\n\n      if (2 * length > data.length) {\n        return null;\n      }\n\n      var name = utf8_1.toUtf8String('0x' + data.substring(0, 2 * length)); // Make sure the reverse record matches the foward record\n\n      return self.resolveName(name).then(function (addr) {\n        if (addr != address) {\n          return null;\n        }\n\n        return name;\n      });\n    });\n  };\n\n  BaseProvider.checkTransactionResponse = function (transaction) {\n    return checkTransactionResponse(transaction);\n  };\n\n  BaseProvider.prototype.doPoll = function () {};\n\n  BaseProvider.prototype.perform = function (method, params) {\n    errors.throwError(method + ' not implemented', errors.NOT_IMPLEMENTED, {\n      operation: method\n    });\n    return null;\n  };\n\n  BaseProvider.prototype._startPending = function () {\n    errors.warn('WARNING: this provider does not support pending events');\n  };\n\n  BaseProvider.prototype._stopPending = function () {};\n\n  BaseProvider.prototype._addEventListener = function (eventName, listener, once) {\n    this._events.push({\n      tag: getEventTag(eventName),\n      listener: listener,\n      once: once\n    });\n\n    if (eventName === 'pending') {\n      this._startPending();\n    }\n\n    this.polling = true;\n  };\n\n  BaseProvider.prototype.on = function (eventName, listener) {\n    this._addEventListener(eventName, listener, false);\n\n    return this;\n  };\n\n  BaseProvider.prototype.once = function (eventName, listener) {\n    this._addEventListener(eventName, listener, true);\n\n    return this;\n  };\n\n  BaseProvider.prototype.addEventListener = function (eventName, listener) {\n    return this.on(eventName, listener);\n  };\n\n  BaseProvider.prototype.emit = function (eventName) {\n    var _this = this;\n\n    var args = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      args[_i - 1] = arguments[_i];\n    }\n\n    var result = false;\n    var eventTag = getEventTag(eventName);\n    this._events = this._events.filter(function (event) {\n      if (event.tag !== eventTag) {\n        return true;\n      }\n\n      setTimeout(function () {\n        event.listener.apply(_this, args);\n      }, 0);\n      result = true;\n      return !event.once;\n    });\n\n    if (this.listenerCount() === 0) {\n      this.polling = false;\n    }\n\n    return result;\n  };\n\n  BaseProvider.prototype.listenerCount = function (eventName) {\n    if (!eventName) {\n      return this._events.length;\n    }\n\n    var eventTag = getEventTag(eventName);\n    return this._events.filter(function (event) {\n      return event.tag === eventTag;\n    }).length;\n  };\n\n  BaseProvider.prototype.listeners = function (eventName) {\n    var eventTag = getEventTag(eventName);\n    return this._events.filter(function (event) {\n      return event.tag === eventTag;\n    }).map(function (event) {\n      return event.listener;\n    });\n  };\n\n  BaseProvider.prototype.removeAllListeners = function (eventName) {\n    if (eventName == null) {\n      this._events = [];\n\n      this._stopPending();\n    } else {\n      var eventTag_1 = getEventTag(eventName);\n      this._events = this._events.filter(function (event) {\n        return event.tag !== eventTag_1;\n      });\n\n      if (eventName === 'pending') {\n        this._stopPending();\n      }\n    }\n\n    if (this._events.length === 0) {\n      this.polling = false;\n    }\n\n    return this;\n  };\n\n  BaseProvider.prototype.removeListener = function (eventName, listener) {\n    var found = false;\n    var eventTag = getEventTag(eventName);\n    this._events = this._events.filter(function (event) {\n      if (event.tag !== eventTag || event.listener != listener) {\n        return true;\n      }\n\n      if (found) {\n        return true;\n      }\n\n      found = true;\n      return false;\n    });\n\n    if (eventName === 'pending' && this.listenerCount('pending') === 0) {\n      this._stopPending();\n    }\n\n    if (this.listenerCount() === 0) {\n      this.polling = false;\n    }\n\n    return this;\n  };\n\n  return BaseProvider;\n}(abstract_provider_1.Provider);\n\nexports.BaseProvider = BaseProvider;\nproperties_1.defineReadOnly(abstract_provider_1.Provider, 'inherits', properties_1.inheritable(abstract_provider_1.Provider));","map":{"version":3,"names":["__extends","extendStatics","Object","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","__importStar","mod","__esModule","result","k","call","defineProperty","exports","value","address_1","require","bignumber_1","bytes_1","constants_1","hash_1","networks_1","properties_1","rlp_1","transaction_1","utf8_1","web_1","errors","abstract_provider_1","check","format","object","key","undefined","error","checkKey","checkValue","allowNull","nullValue","allowFalsish","replaceValue","arrayOf","array","isArray","Error","forEach","push","checkHash","hash","requirePrefix","substring","hexDataLength","toLowerCase","throwError","INVALID_ARGUMENT","arg","checkNumber","number","bigNumberify","toNumber","checkDifficulty","v","checkBoolean","checkUint256","uint256","isHexString","length","checkBlockTag","blockTag","hexStripZeros","hexlify","formatTransaction","blockHash","blockNumber","transactionIndex","confirmations","from","getAddress","gasPrice","gasLimit","to","nonce","data","r","s","creates","raw","checkTransactionResponse","transaction","gas","isZero","input","getContractAddress","stripZeros","encode","networkId","chainId","parseInt","replace","formatBlock","parentHash","timestamp","difficulty","gasUsed","miner","extraData","transactions","formatBlockWithTransactions","shallowCopy","checkBlock","block","includeTransactions","author","formatTransactionRequest","checkTransactionRequest","formatTransactionReceiptLog","transactionLogIndex","transactionHash","address","topics","logIndex","checkTransactionReceiptLog","log","formatTransactionReceipt","contractAddress","root","logsBloom","logs","cumulativeGasUsed","status","checkTransactionReceipt","transactionReceipt","entry","index","byzantium","checkTopics","topic","formatFilter","fromBlock","toBlock","formatFilterByBlock","checkFilter","filter","formatLog","removed","checkLog","serializeTopics","map","argument","join","deserializeTopics","split","comps","getEventTag","eventName","indexOf","getTime","Date","BaseProvider","_super","network","_this","checkNew","Provider","Promise","defineReadOnly","then","ready","catch","knownNetwork","getNetwork","resolve","_network","_lastBlockNumber","_balances","_events","_pollingInterval","_emitted","_fastQueryDate","_doPoll","getBlockNumber","polling","_setFastBlockNumber","i","emit","keys","eventBlockNumber","newBalances","uniqueEventTags","event","tag","hash_2","getTransactionReceipt","receipt","address_2","getBalance","balance","lastBalance","eq","filter_1","getLogs","doPoll","resetEventsBlock","get","enumerable","configurable","_fastBlockNumber","_poller","set","setTimeout","setInterval","bind","pollingInterval","clearInterval","String","_getFastBlockNumber","now","_fastBlockNumberPromise","waitForTransaction","handler","removeListener","on","perform","getGasPrice","addressOrName","resolveProperties","_a","_getAddress","params","getTransactionCount","getCode","getStorageAt","position","sendTransaction","signedTransaction","_wrapTransaction","parse","tx","UNKNOWN_ERROR","expectedHash","returnedHash","wait","CALL_EXCEPTION","_resolveNames","estimateGas","getBlock","blockHashOrBlockTag","blockHash_1","poll","onceBlock","blockNumber_1","blockTag_1","getTransaction","getEtherPrice","resolveName","UNSUPPORTED_OPERATION","operation","JSON","stringify","promises","all","_getResolver","name","ensAddress","namehash","hexDataSlice","AddressZero","self","nodeHash","resolverAddress","lookupAddress","nodehash","toUtf8String","addr","method","NOT_IMPLEMENTED","_startPending","warn","_stopPending","_addEventListener","listener","once","addEventListener","args","_i","arguments","eventTag","apply","listenerCount","listeners","removeAllListeners","eventTag_1","found","inheritable"],"sources":["/Users/jatanasov/Documents/Projects/Colony_BACKUP copy/coding-challenge-events-list-bootstrap/node_modules/ethers/providers/base-provider.js"],"sourcesContent":["'use strict';\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar address_1 = require(\"../utils/address\");\nvar bignumber_1 = require(\"../utils/bignumber\");\nvar bytes_1 = require(\"../utils/bytes\");\nvar constants_1 = require(\"../constants\");\nvar hash_1 = require(\"../utils/hash\");\nvar networks_1 = require(\"../utils/networks\");\nvar properties_1 = require(\"../utils/properties\");\nvar rlp_1 = require(\"../utils/rlp\");\nvar transaction_1 = require(\"../utils/transaction\");\nvar utf8_1 = require(\"../utils/utf8\");\nvar web_1 = require(\"../utils/web\");\nvar errors = __importStar(require(\"../errors\"));\n///////////////////////////////\n// Imported Abstracts\nvar abstract_provider_1 = require(\"./abstract-provider\");\n//////////////////////////////\n// Request and Response Checking\n// @TODO: not any?\nfunction check(format, object) {\n    var result = {};\n    for (var key in format) {\n        try {\n            var value = format[key](object[key]);\n            if (value !== undefined) {\n                result[key] = value;\n            }\n        }\n        catch (error) {\n            error.checkKey = key;\n            error.checkValue = object[key];\n            throw error;\n        }\n    }\n    return result;\n}\nfunction allowNull(check, nullValue) {\n    return (function (value) {\n        if (value == null) {\n            return nullValue;\n        }\n        return check(value);\n    });\n}\nfunction allowFalsish(check, replaceValue) {\n    return (function (value) {\n        if (!value) {\n            return replaceValue;\n        }\n        return check(value);\n    });\n}\nfunction arrayOf(check) {\n    return (function (array) {\n        if (!Array.isArray(array)) {\n            throw new Error('not an array');\n        }\n        var result = [];\n        array.forEach(function (value) {\n            result.push(check(value));\n        });\n        return result;\n    });\n}\nfunction checkHash(hash, requirePrefix) {\n    if (typeof (hash) === 'string') {\n        // geth-etc does add a \"0x\" prefix on receipt.root\n        if (!requirePrefix && hash.substring(0, 2) !== '0x') {\n            hash = '0x' + hash;\n        }\n        if (bytes_1.hexDataLength(hash) === 32) {\n            return hash.toLowerCase();\n        }\n    }\n    errors.throwError('invalid hash', errors.INVALID_ARGUMENT, { arg: 'hash', value: hash });\n    return null;\n}\nfunction checkNumber(number) {\n    return bignumber_1.bigNumberify(number).toNumber();\n}\n// Returns the difficulty as a number, or if too large (i.e. PoA network) null\nfunction checkDifficulty(value) {\n    var v = bignumber_1.bigNumberify(value);\n    try {\n        return v.toNumber();\n    }\n    catch (error) { }\n    return null;\n}\nfunction checkBoolean(value) {\n    if (typeof (value) === 'boolean') {\n        return value;\n    }\n    if (typeof (value) === 'string') {\n        if (value === 'true') {\n            return true;\n        }\n        if (value === 'false') {\n            return false;\n        }\n    }\n    throw new Error('invaid boolean - ' + value);\n}\nfunction checkUint256(uint256) {\n    if (!bytes_1.isHexString(uint256)) {\n        throw new Error('invalid uint256');\n    }\n    while (uint256.length < 66) {\n        uint256 = '0x0' + uint256.substring(2);\n    }\n    return uint256;\n}\n/*\nfunction checkString(string) {\n    if (typeof(string) !== 'string') { throw new Error('invalid string'); }\n    return string;\n}\n*/\nfunction checkBlockTag(blockTag) {\n    if (blockTag == null) {\n        return 'latest';\n    }\n    if (blockTag === 'earliest') {\n        return '0x0';\n    }\n    if (blockTag === 'latest' || blockTag === 'pending') {\n        return blockTag;\n    }\n    if (typeof (blockTag) === 'number') {\n        return bytes_1.hexStripZeros(bytes_1.hexlify(blockTag));\n    }\n    if (bytes_1.isHexString(blockTag)) {\n        return bytes_1.hexStripZeros(blockTag);\n    }\n    throw new Error('invalid blockTag');\n}\nvar formatTransaction = {\n    hash: checkHash,\n    blockHash: allowNull(checkHash, null),\n    blockNumber: allowNull(checkNumber, null),\n    transactionIndex: allowNull(checkNumber, null),\n    confirmations: allowNull(checkNumber, null),\n    from: address_1.getAddress,\n    gasPrice: bignumber_1.bigNumberify,\n    gasLimit: bignumber_1.bigNumberify,\n    to: allowNull(address_1.getAddress, null),\n    value: bignumber_1.bigNumberify,\n    nonce: checkNumber,\n    data: bytes_1.hexlify,\n    r: allowNull(checkUint256),\n    s: allowNull(checkUint256),\n    v: allowNull(checkNumber),\n    creates: allowNull(address_1.getAddress, null),\n    raw: allowNull(bytes_1.hexlify),\n};\nfunction checkTransactionResponse(transaction) {\n    // Rename gas to gasLimit\n    if (transaction.gas != null && transaction.gasLimit == null) {\n        transaction.gasLimit = transaction.gas;\n    }\n    // Some clients (TestRPC) do strange things like return 0x0 for the\n    // 0 address; correct this to be a real address\n    if (transaction.to && bignumber_1.bigNumberify(transaction.to).isZero()) {\n        transaction.to = '0x0000000000000000000000000000000000000000';\n    }\n    // Rename input to data\n    if (transaction.input != null && transaction.data == null) {\n        transaction.data = transaction.input;\n    }\n    // If to and creates are empty, populate the creates from the transaction\n    if (transaction.to == null && transaction.creates == null) {\n        transaction.creates = address_1.getContractAddress(transaction);\n    }\n    // @TODO: use transaction.serialize? Have to add support for including v, r, and s...\n    if (!transaction.raw) {\n        // Very loose providers (e.g. TestRPC) don't provide a signature or raw\n        if (transaction.v && transaction.r && transaction.s) {\n            var raw = [\n                bytes_1.stripZeros(bytes_1.hexlify(transaction.nonce)),\n                bytes_1.stripZeros(bytes_1.hexlify(transaction.gasPrice)),\n                bytes_1.stripZeros(bytes_1.hexlify(transaction.gasLimit)),\n                (transaction.to || \"0x\"),\n                bytes_1.stripZeros(bytes_1.hexlify(transaction.value || '0x')),\n                bytes_1.hexlify(transaction.data || '0x'),\n                bytes_1.stripZeros(bytes_1.hexlify(transaction.v || '0x')),\n                bytes_1.stripZeros(bytes_1.hexlify(transaction.r)),\n                bytes_1.stripZeros(bytes_1.hexlify(transaction.s)),\n            ];\n            transaction.raw = rlp_1.encode(raw);\n        }\n    }\n    var result = check(formatTransaction, transaction);\n    var networkId = transaction.networkId;\n    // geth-etc returns chainId\n    if (transaction.chainId != null && networkId == null && result.v == null) {\n        networkId = transaction.chainId;\n    }\n    if (bytes_1.isHexString(networkId)) {\n        networkId = bignumber_1.bigNumberify(networkId).toNumber();\n    }\n    if (typeof (networkId) !== 'number' && result.v != null) {\n        networkId = (result.v - 35) / 2;\n        if (networkId < 0) {\n            networkId = 0;\n        }\n        networkId = parseInt(networkId);\n    }\n    if (typeof (networkId) !== 'number') {\n        networkId = 0;\n    }\n    result.networkId = networkId;\n    if (result.chainId == null && networkId != null) {\n        result.chainId = networkId;\n    }\n    // 0x0000... should actually be null\n    if (result.blockHash && result.blockHash.replace(/0/g, '') === 'x') {\n        result.blockHash = null;\n    }\n    return result;\n}\nvar formatBlock = {\n    hash: checkHash,\n    parentHash: checkHash,\n    number: checkNumber,\n    timestamp: checkNumber,\n    nonce: allowNull(bytes_1.hexlify),\n    difficulty: checkDifficulty,\n    gasLimit: bignumber_1.bigNumberify,\n    gasUsed: bignumber_1.bigNumberify,\n    miner: address_1.getAddress,\n    extraData: bytes_1.hexlify,\n    transactions: allowNull(arrayOf(checkHash)),\n};\nvar formatBlockWithTransactions = properties_1.shallowCopy(formatBlock);\nformatBlockWithTransactions.transactions = allowNull(arrayOf(checkTransactionResponse));\nfunction checkBlock(block, includeTransactions) {\n    if (block.author != null && block.miner == null) {\n        block.miner = block.author;\n    }\n    return check(includeTransactions ? formatBlockWithTransactions : formatBlock, block);\n}\nvar formatTransactionRequest = {\n    from: allowNull(address_1.getAddress),\n    nonce: allowNull(checkNumber),\n    gasLimit: allowNull(bignumber_1.bigNumberify),\n    gasPrice: allowNull(bignumber_1.bigNumberify),\n    to: allowNull(address_1.getAddress),\n    value: allowNull(bignumber_1.bigNumberify),\n    data: allowNull(bytes_1.hexlify),\n};\nfunction checkTransactionRequest(transaction) {\n    return check(formatTransactionRequest, transaction);\n}\nvar formatTransactionReceiptLog = {\n    transactionLogIndex: allowNull(checkNumber),\n    transactionIndex: checkNumber,\n    blockNumber: checkNumber,\n    transactionHash: checkHash,\n    address: address_1.getAddress,\n    topics: arrayOf(checkHash),\n    data: bytes_1.hexlify,\n    logIndex: checkNumber,\n    blockHash: checkHash,\n};\nfunction checkTransactionReceiptLog(log) {\n    return check(formatTransactionReceiptLog, log);\n}\nvar formatTransactionReceipt = {\n    to: allowNull(address_1.getAddress, null),\n    from: allowNull(address_1.getAddress, null),\n    contractAddress: allowNull(address_1.getAddress, null),\n    transactionIndex: checkNumber,\n    root: allowNull(checkHash),\n    gasUsed: bignumber_1.bigNumberify,\n    logsBloom: allowNull(bytes_1.hexlify),\n    blockHash: checkHash,\n    transactionHash: checkHash,\n    logs: arrayOf(checkTransactionReceiptLog),\n    blockNumber: checkNumber,\n    confirmations: allowNull(checkNumber, null),\n    cumulativeGasUsed: bignumber_1.bigNumberify,\n    status: allowNull(checkNumber)\n};\nfunction checkTransactionReceipt(transactionReceipt) {\n    //var status = transactionReceipt.status;\n    //var root = transactionReceipt.root;\n    var result = check(formatTransactionReceipt, transactionReceipt);\n    result.logs.forEach(function (entry, index) {\n        if (entry.transactionLogIndex == null) {\n            entry.transactionLogIndex = index;\n        }\n    });\n    if (transactionReceipt.status != null) {\n        result.byzantium = true;\n    }\n    return result;\n}\nfunction checkTopics(topics) {\n    if (Array.isArray(topics)) {\n        topics.forEach(function (topic) {\n            checkTopics(topic);\n        });\n    }\n    else if (topics != null) {\n        checkHash(topics);\n    }\n    return topics;\n}\nvar formatFilter = {\n    fromBlock: allowNull(checkBlockTag, undefined),\n    toBlock: allowNull(checkBlockTag, undefined),\n    address: allowNull(address_1.getAddress, undefined),\n    topics: allowNull(checkTopics, undefined),\n};\nvar formatFilterByBlock = {\n    blockHash: allowNull(checkHash, undefined),\n    address: allowNull(address_1.getAddress, undefined),\n    topics: allowNull(checkTopics, undefined),\n};\nfunction checkFilter(filter) {\n    if (filter && filter.blockHash) {\n        return check(formatFilterByBlock, filter);\n    }\n    return check(formatFilter, filter);\n}\nvar formatLog = {\n    blockNumber: allowNull(checkNumber),\n    blockHash: allowNull(checkHash),\n    transactionIndex: checkNumber,\n    removed: allowNull(checkBoolean),\n    address: address_1.getAddress,\n    data: allowFalsish(bytes_1.hexlify, '0x'),\n    topics: arrayOf(checkHash),\n    transactionHash: checkHash,\n    logIndex: checkNumber,\n};\nfunction checkLog(log) {\n    return check(formatLog, log);\n}\n//////////////////////////////\n// Event Serializeing\nfunction serializeTopics(topics) {\n    return topics.map(function (topic) {\n        if (typeof (topic) === 'string') {\n            return topic;\n        }\n        else if (Array.isArray(topic)) {\n            topic.forEach(function (topic) {\n                if (topic !== null && bytes_1.hexDataLength(topic) !== 32) {\n                    errors.throwError('invalid topic', errors.INVALID_ARGUMENT, { argument: 'topic', value: topic });\n                }\n            });\n            return topic.join(',');\n        }\n        else if (topic === null) {\n            return '';\n        }\n        return errors.throwError('invalid topic value', errors.INVALID_ARGUMENT, { argument: 'topic', value: topic });\n    }).join('&');\n}\nfunction deserializeTopics(data) {\n    return data.split(/&/g).map(function (topic) {\n        var comps = topic.split(',');\n        if (comps.length === 1) {\n            if (comps[0] === '') {\n                return null;\n            }\n            return topic;\n        }\n        return comps.map(function (topic) {\n            if (topic === '') {\n                return null;\n            }\n            return topic;\n        });\n    });\n}\nfunction getEventTag(eventName) {\n    if (typeof (eventName) === 'string') {\n        if (bytes_1.hexDataLength(eventName) === 20) {\n            return 'address:' + address_1.getAddress(eventName);\n        }\n        eventName = eventName.toLowerCase();\n        if (bytes_1.hexDataLength(eventName) === 32) {\n            return 'tx:' + eventName;\n        }\n        if (eventName.indexOf(':') === -1) {\n            return eventName;\n        }\n    }\n    else if (Array.isArray(eventName)) {\n        return 'filter::' + serializeTopics(eventName);\n    }\n    else if (eventName && typeof (eventName) === 'object') {\n        return 'filter:' + (eventName.address || '') + ':' + serializeTopics(eventName.topics || []);\n    }\n    throw new Error('invalid event - ' + eventName);\n}\n//////////////////////////////\n// Helper Object\nfunction getTime() {\n    return (new Date()).getTime();\n}\nvar BaseProvider = /** @class */ (function (_super) {\n    __extends(BaseProvider, _super);\n    function BaseProvider(network) {\n        var _this = _super.call(this) || this;\n        errors.checkNew(_this, abstract_provider_1.Provider);\n        if (network instanceof Promise) {\n            properties_1.defineReadOnly(_this, 'ready', network.then(function (network) {\n                properties_1.defineReadOnly(_this, '_network', network);\n                return network;\n            }));\n            // Squash any \"unhandled promise\" errors; the don't need to be handled\n            _this.ready.catch(function (error) { });\n        }\n        else {\n            var knownNetwork = networks_1.getNetwork((network == null) ? 'homestead' : network);\n            if (knownNetwork) {\n                properties_1.defineReadOnly(_this, '_network', knownNetwork);\n                properties_1.defineReadOnly(_this, 'ready', Promise.resolve(_this._network));\n            }\n            else {\n                errors.throwError('invalid network', errors.INVALID_ARGUMENT, { arg: 'network', value: network });\n            }\n        }\n        _this._lastBlockNumber = -2;\n        // Balances being watched for changes\n        _this._balances = {};\n        // Events being listened to\n        _this._events = [];\n        _this._pollingInterval = 4000;\n        _this._emitted = { block: -2 };\n        _this._fastQueryDate = 0;\n        return _this;\n    }\n    BaseProvider.prototype._doPoll = function () {\n        var _this = this;\n        this.getBlockNumber().then(function (blockNumber) {\n            if (!_this.polling) {\n                return;\n            }\n            _this._setFastBlockNumber(blockNumber);\n            // If the block hasn't changed, meh.\n            if (blockNumber === _this._lastBlockNumber) {\n                return;\n            }\n            // First polling cycle, trigger a \"block\" events\n            if (_this._emitted.block === -2) {\n                _this._emitted.block = blockNumber - 1;\n            }\n            // Notify all listener for each block that has passed\n            for (var i = _this._emitted.block + 1; i <= blockNumber; i++) {\n                _this.emit('block', i);\n            }\n            // The emitted block was updated, check for obsolete events\n            if (_this._emitted.block !== blockNumber) {\n                _this._emitted.block = blockNumber;\n                Object.keys(_this._emitted).forEach(function (key) {\n                    // The block event does not expire\n                    if (key === 'block') {\n                        return;\n                    }\n                    // The block we were at when we emitted this event\n                    var eventBlockNumber = _this._emitted[key];\n                    // We cannot garbage collect pending transactions or blocks here\n                    // They should be garbage collected by the Provider when setting\n                    // \"pending\" events\n                    if (eventBlockNumber === 'pending') {\n                        return;\n                    }\n                    // Evict any transaction hashes or block hashes over 12 blocks\n                    // old, since they should not return null anyways\n                    if (blockNumber - eventBlockNumber > 12) {\n                        delete _this._emitted[key];\n                    }\n                });\n            }\n            // First polling cycle\n            if (_this._lastBlockNumber === -2) {\n                _this._lastBlockNumber = blockNumber - 1;\n            }\n            // Sweep balances and remove addresses we no longer have events for\n            var newBalances = {};\n            // Find all transaction hashes we are waiting on\n            var uniqueEventTags = {};\n            _this._events.forEach(function (event) {\n                uniqueEventTags[event.tag] = true;\n            });\n            Object.keys(uniqueEventTags).forEach(function (tag) {\n                var comps = tag.split(':');\n                switch (comps[0]) {\n                    case 'tx': {\n                        var hash_2 = comps[1];\n                        _this.getTransactionReceipt(hash_2).then(function (receipt) {\n                            if (!receipt || receipt.blockNumber == null) {\n                                return null;\n                            }\n                            _this._emitted['t:' + hash_2] = receipt.blockNumber;\n                            _this.emit(hash_2, receipt);\n                            return null;\n                        }).catch(function (error) { _this.emit('error', error); });\n                        break;\n                    }\n                    case 'address': {\n                        var address_2 = comps[1];\n                        if (_this._balances[address_2]) {\n                            newBalances[address_2] = _this._balances[address_2];\n                        }\n                        _this.getBalance(address_2, 'latest').then(function (balance) {\n                            var lastBalance = _this._balances[address_2];\n                            if (lastBalance && balance.eq(lastBalance)) {\n                                return;\n                            }\n                            _this._balances[address_2] = balance;\n                            _this.emit(address_2, balance);\n                            return null;\n                        }).catch(function (error) { _this.emit('error', error); });\n                        break;\n                    }\n                    case 'filter': {\n                        var topics = deserializeTopics(comps[2]);\n                        var filter_1 = {\n                            address: comps[1],\n                            fromBlock: _this._lastBlockNumber + 1,\n                            toBlock: blockNumber,\n                            topics: topics\n                        };\n                        if (!filter_1.address) {\n                            delete filter_1.address;\n                        }\n                        _this.getLogs(filter_1).then(function (logs) {\n                            if (logs.length === 0) {\n                                return;\n                            }\n                            logs.forEach(function (log) {\n                                _this._emitted['b:' + log.blockHash] = log.blockNumber;\n                                _this._emitted['t:' + log.transactionHash] = log.blockNumber;\n                                _this.emit(filter_1, log);\n                            });\n                            return null;\n                        }).catch(function (error) { _this.emit('error', error); });\n                        break;\n                    }\n                }\n            });\n            _this._lastBlockNumber = blockNumber;\n            _this._balances = newBalances;\n            return null;\n        }).catch(function (error) { });\n        this.doPoll();\n    };\n    BaseProvider.prototype.resetEventsBlock = function (blockNumber) {\n        this._lastBlockNumber = blockNumber - 1;\n        if (this.polling) {\n            this._doPoll();\n        }\n    };\n    Object.defineProperty(BaseProvider.prototype, \"network\", {\n        get: function () {\n            return this._network;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    BaseProvider.prototype.getNetwork = function () {\n        return this.ready;\n    };\n    Object.defineProperty(BaseProvider.prototype, \"blockNumber\", {\n        get: function () {\n            return this._fastBlockNumber;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BaseProvider.prototype, \"polling\", {\n        get: function () {\n            return (this._poller != null);\n        },\n        set: function (value) {\n            var _this = this;\n            setTimeout(function () {\n                if (value && !_this._poller) {\n                    _this._poller = setInterval(_this._doPoll.bind(_this), _this.pollingInterval);\n                    _this._doPoll();\n                }\n                else if (!value && _this._poller) {\n                    clearInterval(_this._poller);\n                    _this._poller = null;\n                }\n            }, 0);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BaseProvider.prototype, \"pollingInterval\", {\n        get: function () {\n            return this._pollingInterval;\n        },\n        set: function (value) {\n            var _this = this;\n            if (typeof (value) !== 'number' || value <= 0 || parseInt(String(value)) != value) {\n                throw new Error('invalid polling interval');\n            }\n            this._pollingInterval = value;\n            if (this._poller) {\n                clearInterval(this._poller);\n                this._poller = setInterval(function () { _this._doPoll(); }, this._pollingInterval);\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    BaseProvider.prototype._getFastBlockNumber = function () {\n        var _this = this;\n        var now = getTime();\n        // Stale block number, request a newer value\n        if ((now - this._fastQueryDate) > 2 * this._pollingInterval) {\n            this._fastQueryDate = now;\n            this._fastBlockNumberPromise = this.getBlockNumber().then(function (blockNumber) {\n                if (_this._fastBlockNumber == null || blockNumber > _this._fastBlockNumber) {\n                    _this._fastBlockNumber = blockNumber;\n                }\n                return _this._fastBlockNumber;\n            });\n        }\n        return this._fastBlockNumberPromise;\n    };\n    BaseProvider.prototype._setFastBlockNumber = function (blockNumber) {\n        // Older block, maybe a stale request\n        if (this._fastBlockNumber != null && blockNumber < this._fastBlockNumber) {\n            return;\n        }\n        // Update the time we updated the blocknumber\n        this._fastQueryDate = getTime();\n        // Newer block number, use  it\n        if (this._fastBlockNumber == null || blockNumber > this._fastBlockNumber) {\n            this._fastBlockNumber = blockNumber;\n            this._fastBlockNumberPromise = Promise.resolve(blockNumber);\n        }\n    };\n    // @TODO: Add .poller which must be an event emitter with a 'start', 'stop' and 'block' event;\n    //        this will be used once we move to the WebSocket or other alternatives to polling\n    BaseProvider.prototype.waitForTransaction = function (transactionHash, confirmations) {\n        var _this = this;\n        if (confirmations == null) {\n            confirmations = 1;\n        }\n        return this.getTransactionReceipt(transactionHash).then(function (receipt) {\n            if (confirmations === 0 || (receipt && receipt.confirmations >= confirmations)) {\n                return receipt;\n            }\n            return (new Promise(function (resolve) {\n                var handler = function (receipt) {\n                    if (receipt.confirmations < confirmations) {\n                        return;\n                    }\n                    _this.removeListener(transactionHash, handler);\n                    resolve(receipt);\n                };\n                _this.on(transactionHash, handler);\n            }));\n        });\n    };\n    BaseProvider.prototype.getBlockNumber = function () {\n        var _this = this;\n        return this.ready.then(function () {\n            return _this.perform('getBlockNumber', {}).then(function (result) {\n                var value = parseInt(result);\n                if (value != result) {\n                    throw new Error('invalid response - getBlockNumber');\n                }\n                _this._setFastBlockNumber(value);\n                return value;\n            });\n        });\n    };\n    BaseProvider.prototype.getGasPrice = function () {\n        var _this = this;\n        return this.ready.then(function () {\n            return _this.perform('getGasPrice', {}).then(function (result) {\n                return bignumber_1.bigNumberify(result);\n            });\n        });\n    };\n    BaseProvider.prototype.getBalance = function (addressOrName, blockTag) {\n        var _this = this;\n        return this.ready.then(function () {\n            return properties_1.resolveProperties({ addressOrName: addressOrName, blockTag: blockTag }).then(function (_a) {\n                var addressOrName = _a.addressOrName, blockTag = _a.blockTag;\n                return _this._getAddress(addressOrName).then(function (address) {\n                    var params = { address: address, blockTag: checkBlockTag(blockTag) };\n                    return _this.perform('getBalance', params).then(function (result) {\n                        return bignumber_1.bigNumberify(result);\n                    });\n                });\n            });\n        });\n    };\n    BaseProvider.prototype.getTransactionCount = function (addressOrName, blockTag) {\n        var _this = this;\n        return this.ready.then(function () {\n            return properties_1.resolveProperties({ addressOrName: addressOrName, blockTag: blockTag }).then(function (_a) {\n                var addressOrName = _a.addressOrName, blockTag = _a.blockTag;\n                return _this._getAddress(addressOrName).then(function (address) {\n                    var params = { address: address, blockTag: checkBlockTag(blockTag) };\n                    return _this.perform('getTransactionCount', params).then(function (result) {\n                        return bignumber_1.bigNumberify(result).toNumber();\n                    });\n                });\n            });\n        });\n    };\n    BaseProvider.prototype.getCode = function (addressOrName, blockTag) {\n        var _this = this;\n        return this.ready.then(function () {\n            return properties_1.resolveProperties({ addressOrName: addressOrName, blockTag: blockTag }).then(function (_a) {\n                var addressOrName = _a.addressOrName, blockTag = _a.blockTag;\n                return _this._getAddress(addressOrName).then(function (address) {\n                    var params = { address: address, blockTag: checkBlockTag(blockTag) };\n                    return _this.perform('getCode', params).then(function (result) {\n                        return bytes_1.hexlify(result);\n                    });\n                });\n            });\n        });\n    };\n    BaseProvider.prototype.getStorageAt = function (addressOrName, position, blockTag) {\n        var _this = this;\n        return this.ready.then(function () {\n            return properties_1.resolveProperties({ addressOrName: addressOrName, position: position, blockTag: blockTag }).then(function (_a) {\n                var addressOrName = _a.addressOrName, position = _a.position, blockTag = _a.blockTag;\n                return _this._getAddress(addressOrName).then(function (address) {\n                    var params = {\n                        address: address,\n                        blockTag: checkBlockTag(blockTag),\n                        position: bytes_1.hexStripZeros(bytes_1.hexlify(position)),\n                    };\n                    return _this.perform('getStorageAt', params).then(function (result) {\n                        return bytes_1.hexlify(result);\n                    });\n                });\n            });\n        });\n    };\n    BaseProvider.prototype.sendTransaction = function (signedTransaction) {\n        var _this = this;\n        return this.ready.then(function () {\n            return properties_1.resolveProperties({ signedTransaction: signedTransaction }).then(function (_a) {\n                var signedTransaction = _a.signedTransaction;\n                var params = { signedTransaction: bytes_1.hexlify(signedTransaction) };\n                return _this.perform('sendTransaction', params).then(function (hash) {\n                    return _this._wrapTransaction(transaction_1.parse(signedTransaction), hash);\n                }, function (error) {\n                    error.transaction = transaction_1.parse(signedTransaction);\n                    if (error.transaction.hash) {\n                        error.transactionHash = error.transaction.hash;\n                    }\n                    throw error;\n                });\n            });\n        });\n    };\n    // This should be called by any subclass wrapping a TransactionResponse\n    BaseProvider.prototype._wrapTransaction = function (tx, hash) {\n        var _this = this;\n        if (hash != null && bytes_1.hexDataLength(hash) !== 32) {\n            throw new Error('invalid response - sendTransaction');\n        }\n        var result = tx;\n        // Check the hash we expect is the same as the hash the server reported\n        if (hash != null && tx.hash !== hash) {\n            errors.throwError('Transaction hash mismatch from Provider.sendTransaction.', errors.UNKNOWN_ERROR, { expectedHash: tx.hash, returnedHash: hash });\n        }\n        // @TODO: (confirmations? number, timeout? number)\n        result.wait = function (confirmations) {\n            // We know this transaction *must* exist (whether it gets mined is\n            // another story), so setting an emitted value forces us to\n            // wait even if the node returns null for the receipt\n            if (confirmations !== 0) {\n                _this._emitted['t:' + tx.hash] = 'pending';\n            }\n            return _this.waitForTransaction(tx.hash, confirmations).then(function (receipt) {\n                if (receipt == null && confirmations === 0) {\n                    return null;\n                }\n                // No longer pending, allow the polling loop to garbage collect this\n                _this._emitted['t:' + tx.hash] = receipt.blockNumber;\n                if (receipt.status === 0) {\n                    errors.throwError('transaction failed', errors.CALL_EXCEPTION, {\n                        transactionHash: tx.hash,\n                        transaction: tx\n                    });\n                }\n                return receipt;\n            });\n        };\n        return result;\n    };\n    BaseProvider.prototype.call = function (transaction, blockTag) {\n        var _this = this;\n        var tx = properties_1.shallowCopy(transaction);\n        return this.ready.then(function () {\n            return properties_1.resolveProperties({ blockTag: blockTag, tx: tx }).then(function (_a) {\n                var blockTag = _a.blockTag, tx = _a.tx;\n                return _this._resolveNames(tx, ['to', 'from']).then(function (tx) {\n                    var params = { blockTag: checkBlockTag(blockTag), transaction: checkTransactionRequest(tx) };\n                    return _this.perform('call', params).then(function (result) {\n                        return bytes_1.hexlify(result);\n                    });\n                });\n            });\n        });\n    };\n    BaseProvider.prototype.estimateGas = function (transaction) {\n        var _this = this;\n        var tx = {\n            to: transaction.to,\n            from: transaction.from,\n            data: transaction.data,\n            gasPrice: transaction.gasPrice,\n            value: transaction.value\n        };\n        return this.ready.then(function () {\n            return properties_1.resolveProperties(tx).then(function (tx) {\n                return _this._resolveNames(tx, ['to', 'from']).then(function (tx) {\n                    var params = { transaction: checkTransactionRequest(tx) };\n                    return _this.perform('estimateGas', params).then(function (result) {\n                        return bignumber_1.bigNumberify(result);\n                    });\n                });\n            });\n        });\n    };\n    BaseProvider.prototype.getBlock = function (blockHashOrBlockTag, includeTransactions) {\n        var _this = this;\n        return this.ready.then(function () {\n            return properties_1.resolveProperties({ blockHashOrBlockTag: blockHashOrBlockTag }).then(function (_a) {\n                var blockHashOrBlockTag = _a.blockHashOrBlockTag;\n                try {\n                    var blockHash_1 = bytes_1.hexlify(blockHashOrBlockTag);\n                    if (bytes_1.hexDataLength(blockHash_1) === 32) {\n                        return web_1.poll(function () {\n                            return _this.perform('getBlock', { blockHash: blockHash_1, includeTransactions: !!includeTransactions }).then(function (block) {\n                                if (block == null) {\n                                    if (_this._emitted['b:' + blockHash_1] == null) {\n                                        return null;\n                                    }\n                                    return undefined;\n                                }\n                                return checkBlock(block, includeTransactions);\n                            });\n                        }, { onceBlock: _this });\n                    }\n                }\n                catch (error) { }\n                try {\n                    var blockNumber_1 = -128;\n                    var blockTag_1 = checkBlockTag(blockHashOrBlockTag);\n                    if (bytes_1.isHexString(blockTag_1)) {\n                        blockNumber_1 = parseInt(blockTag_1.substring(2), 16);\n                    }\n                    return web_1.poll(function () {\n                        return _this.perform('getBlock', { blockTag: blockTag_1, includeTransactions: !!includeTransactions }).then(function (block) {\n                            if (block == null) {\n                                if (blockNumber_1 <= _this._emitted.block) {\n                                    return undefined;\n                                }\n                                return null;\n                            }\n                            return checkBlock(block, includeTransactions);\n                        });\n                    }, { onceBlock: _this });\n                }\n                catch (error) { }\n                throw new Error('invalid block hash or block tag');\n            });\n        });\n    };\n    BaseProvider.prototype.getTransaction = function (transactionHash) {\n        var _this = this;\n        return this.ready.then(function () {\n            return properties_1.resolveProperties({ transactionHash: transactionHash }).then(function (_a) {\n                var transactionHash = _a.transactionHash;\n                var params = { transactionHash: checkHash(transactionHash, true) };\n                return web_1.poll(function () {\n                    return _this.perform('getTransaction', params).then(function (result) {\n                        if (result == null) {\n                            if (_this._emitted['t:' + transactionHash] == null) {\n                                return null;\n                            }\n                            return undefined;\n                        }\n                        var tx = BaseProvider.checkTransactionResponse(result);\n                        if (tx.blockNumber == null) {\n                            tx.confirmations = 0;\n                        }\n                        else if (tx.confirmations == null) {\n                            return _this._getFastBlockNumber().then(function (blockNumber) {\n                                // Add the confirmations using the fast block number (pessimistic)\n                                var confirmations = (blockNumber - tx.blockNumber) + 1;\n                                if (confirmations <= 0) {\n                                    confirmations = 1;\n                                }\n                                tx.confirmations = confirmations;\n                                return _this._wrapTransaction(tx);\n                            });\n                        }\n                        return _this._wrapTransaction(tx);\n                    });\n                }, { onceBlock: _this });\n            });\n        });\n    };\n    BaseProvider.prototype.getTransactionReceipt = function (transactionHash) {\n        var _this = this;\n        return this.ready.then(function () {\n            return properties_1.resolveProperties({ transactionHash: transactionHash }).then(function (_a) {\n                var transactionHash = _a.transactionHash;\n                var params = { transactionHash: checkHash(transactionHash, true) };\n                return web_1.poll(function () {\n                    return _this.perform('getTransactionReceipt', params).then(function (result) {\n                        if (result == null) {\n                            if (_this._emitted['t:' + transactionHash] == null) {\n                                return null;\n                            }\n                            return undefined;\n                        }\n                        // \"geth-etc\" returns receipts before they are ready\n                        if (result.blockHash == null) {\n                            return undefined;\n                        }\n                        var receipt = checkTransactionReceipt(result);\n                        if (receipt.blockNumber == null) {\n                            receipt.confirmations = 0;\n                        }\n                        else if (receipt.confirmations == null) {\n                            return _this._getFastBlockNumber().then(function (blockNumber) {\n                                // Add the confirmations using the fast block number (pessimistic)\n                                var confirmations = (blockNumber - receipt.blockNumber) + 1;\n                                if (confirmations <= 0) {\n                                    confirmations = 1;\n                                }\n                                receipt.confirmations = confirmations;\n                                return receipt;\n                            });\n                        }\n                        return receipt;\n                    });\n                }, { onceBlock: _this });\n            });\n        });\n    };\n    BaseProvider.prototype.getLogs = function (filter) {\n        var _this = this;\n        return this.ready.then(function () {\n            return properties_1.resolveProperties(filter).then(function (filter) {\n                return _this._resolveNames(filter, ['address']).then(function (filter) {\n                    var params = { filter: checkFilter(filter) };\n                    return _this.perform('getLogs', params).then(function (result) {\n                        return arrayOf(checkLog)(result);\n                    });\n                });\n            });\n        });\n    };\n    BaseProvider.prototype.getEtherPrice = function () {\n        var _this = this;\n        return this.ready.then(function () {\n            return _this.perform('getEtherPrice', {}).then(function (result) {\n                // @TODO: Check valid float\n                return result;\n            });\n        });\n    };\n    BaseProvider.prototype._getAddress = function (addressOrName) {\n        return this.resolveName(addressOrName).then(function (address) {\n            if (address == null) {\n                errors.throwError(\"ENS name not configured\", errors.UNSUPPORTED_OPERATION, { operation: \"resolveName(\" + JSON.stringify(addressOrName) + \")\" });\n            }\n            return address;\n        });\n    };\n    // @TODO: Could probably use resolveProperties instead?\n    BaseProvider.prototype._resolveNames = function (object, keys) {\n        var promises = [];\n        var result = properties_1.shallowCopy(object);\n        keys.forEach(function (key) {\n            if (result[key] == null) {\n                return;\n            }\n            promises.push(this._getAddress(result[key]).then(function (address) {\n                result[key] = address;\n                return;\n            }));\n        }, this);\n        return Promise.all(promises).then(function () { return result; });\n    };\n    BaseProvider.prototype._getResolver = function (name) {\n        var _this = this;\n        // Get the resolver from the blockchain\n        return this.getNetwork().then(function (network) {\n            // No ENS...\n            if (!network.ensAddress) {\n                errors.throwError('network does not support ENS', errors.UNSUPPORTED_OPERATION, { operation: 'ENS', network: network.name });\n            }\n            // keccak256('resolver(bytes32)')\n            var data = '0x0178b8bf' + hash_1.namehash(name).substring(2);\n            var transaction = { to: network.ensAddress, data: data };\n            return _this.call(transaction).then(function (data) {\n                // extract the address from the data\n                if (bytes_1.hexDataLength(data) !== 32) {\n                    return null;\n                }\n                var address = address_1.getAddress(bytes_1.hexDataSlice(data, 12));\n                if (address === constants_1.AddressZero) {\n                    return null;\n                }\n                return address;\n            });\n        });\n    };\n    BaseProvider.prototype.resolveName = function (name) {\n        var _this = this;\n        // If it is a promise, resolve it then recurse\n        if (name instanceof Promise) {\n            return name.then(function (addressOrName) {\n                return _this.resolveName(addressOrName);\n            });\n        }\n        // If it is already an address, nothing to resolve\n        try {\n            return Promise.resolve(address_1.getAddress(name));\n        }\n        catch (error) {\n            // See #694\n            if (bytes_1.isHexString(name)) {\n                throw error;\n            }\n        }\n        var self = this;\n        var nodeHash = hash_1.namehash(name);\n        // Get the addr from the resovler\n        return this._getResolver(name).then(function (resolverAddress) {\n            if (resolverAddress == null) {\n                return null;\n            }\n            // keccak256('addr(bytes32)')\n            var data = '0x3b3b57de' + nodeHash.substring(2);\n            var transaction = { to: resolverAddress, data: data };\n            return self.call(transaction);\n            // extract the address from the data\n        }).then(function (data) {\n            if (bytes_1.hexDataLength(data) !== 32) {\n                return null;\n            }\n            var address = address_1.getAddress(bytes_1.hexDataSlice(data, 12));\n            if (address === constants_1.AddressZero) {\n                return null;\n            }\n            return address;\n        });\n    };\n    BaseProvider.prototype.lookupAddress = function (address) {\n        var _this = this;\n        if (address instanceof Promise) {\n            return address.then(function (address) {\n                return _this.lookupAddress(address);\n            });\n        }\n        address = address_1.getAddress(address);\n        var name = address.substring(2) + '.addr.reverse';\n        var nodehash = hash_1.namehash(name);\n        var self = this;\n        return this._getResolver(name).then(function (resolverAddress) {\n            if (!resolverAddress) {\n                return null;\n            }\n            // keccak('name(bytes32)')\n            var data = '0x691f3431' + nodehash.substring(2);\n            var transaction = { to: resolverAddress, data: data };\n            return self.call(transaction);\n        }).then(function (data) {\n            if (data == null) {\n                return null;\n            }\n            // Strip off the \"0x\"\n            data = data.substring(2);\n            // Strip off the dynamic string pointer (0x20)\n            if (data.length < 64) {\n                return null;\n            }\n            data = data.substring(64);\n            if (data.length < 64) {\n                return null;\n            }\n            var length = bignumber_1.bigNumberify('0x' + data.substring(0, 64)).toNumber();\n            data = data.substring(64);\n            if (2 * length > data.length) {\n                return null;\n            }\n            var name = utf8_1.toUtf8String('0x' + data.substring(0, 2 * length));\n            // Make sure the reverse record matches the foward record\n            return self.resolveName(name).then(function (addr) {\n                if (addr != address) {\n                    return null;\n                }\n                return name;\n            });\n        });\n    };\n    BaseProvider.checkTransactionResponse = function (transaction) {\n        return checkTransactionResponse(transaction);\n    };\n    BaseProvider.prototype.doPoll = function () {\n    };\n    BaseProvider.prototype.perform = function (method, params) {\n        errors.throwError(method + ' not implemented', errors.NOT_IMPLEMENTED, { operation: method });\n        return null;\n    };\n    BaseProvider.prototype._startPending = function () {\n        errors.warn('WARNING: this provider does not support pending events');\n    };\n    BaseProvider.prototype._stopPending = function () {\n    };\n    BaseProvider.prototype._addEventListener = function (eventName, listener, once) {\n        this._events.push({\n            tag: getEventTag(eventName),\n            listener: listener,\n            once: once,\n        });\n        if (eventName === 'pending') {\n            this._startPending();\n        }\n        this.polling = true;\n    };\n    BaseProvider.prototype.on = function (eventName, listener) {\n        this._addEventListener(eventName, listener, false);\n        return this;\n    };\n    BaseProvider.prototype.once = function (eventName, listener) {\n        this._addEventListener(eventName, listener, true);\n        return this;\n    };\n    BaseProvider.prototype.addEventListener = function (eventName, listener) {\n        return this.on(eventName, listener);\n    };\n    BaseProvider.prototype.emit = function (eventName) {\n        var _this = this;\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        var result = false;\n        var eventTag = getEventTag(eventName);\n        this._events = this._events.filter(function (event) {\n            if (event.tag !== eventTag) {\n                return true;\n            }\n            setTimeout(function () {\n                event.listener.apply(_this, args);\n            }, 0);\n            result = true;\n            return !(event.once);\n        });\n        if (this.listenerCount() === 0) {\n            this.polling = false;\n        }\n        return result;\n    };\n    BaseProvider.prototype.listenerCount = function (eventName) {\n        if (!eventName) {\n            return this._events.length;\n        }\n        var eventTag = getEventTag(eventName);\n        return this._events.filter(function (event) {\n            return (event.tag === eventTag);\n        }).length;\n    };\n    BaseProvider.prototype.listeners = function (eventName) {\n        var eventTag = getEventTag(eventName);\n        return this._events.filter(function (event) {\n            return (event.tag === eventTag);\n        }).map(function (event) {\n            return event.listener;\n        });\n    };\n    BaseProvider.prototype.removeAllListeners = function (eventName) {\n        if (eventName == null) {\n            this._events = [];\n            this._stopPending();\n        }\n        else {\n            var eventTag_1 = getEventTag(eventName);\n            this._events = this._events.filter(function (event) {\n                return (event.tag !== eventTag_1);\n            });\n            if (eventName === 'pending') {\n                this._stopPending();\n            }\n        }\n        if (this._events.length === 0) {\n            this.polling = false;\n        }\n        return this;\n    };\n    BaseProvider.prototype.removeListener = function (eventName, listener) {\n        var found = false;\n        var eventTag = getEventTag(eventName);\n        this._events = this._events.filter(function (event) {\n            if (event.tag !== eventTag || event.listener != listener) {\n                return true;\n            }\n            if (found) {\n                return true;\n            }\n            found = true;\n            return false;\n        });\n        if (eventName === 'pending' && this.listenerCount('pending') === 0) {\n            this._stopPending();\n        }\n        if (this.listenerCount() === 0) {\n            this.polling = false;\n        }\n        return this;\n    };\n    return BaseProvider;\n}(abstract_provider_1.Provider));\nexports.BaseProvider = BaseProvider;\nproperties_1.defineReadOnly(abstract_provider_1.Provider, 'inherits', properties_1.inheritable(abstract_provider_1.Provider));\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}